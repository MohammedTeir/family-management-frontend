import{u as B,t as I,a as A,r as t,b as O,j as e,C as P,e as y,f as C,d as S,x as m,I as d,B as E,O as L,X as R}from"./index-ZYzdAsGm.js";import{H as T}from"./header-qJrll5lw.js";import"./dropdown-menu-C5FzIU9D.js";function M(){const{user:s,isLoading:k}=B(),{toast:c}=I(),[,l]=A(),[x,u]=t.useState(""),[i,h]=t.useState(""),[f,g]=t.useState(""),[p,b]=t.useState(!1),[W,j]=t.useState(!0),[X,q]=t.useState(null),[w,N]=t.useState(null),[v,o]=t.useState(null),[D,F]=t.useState({username:(s==null?void 0:s.username)||"",gender:(s==null?void 0:s.gender)||"male"}),{settings:a}=O();t.useEffect(()=>{s&&(async()=>{try{j(!0);const n=await L.get("/api/user/profile");F({username:n.data.username,gender:n.data.gender||"male"})}catch(n){console.error("Error fetching profile:",n),q("حدث خطأ أثناء تحميل بيانات الملف الشخصي"),c({title:"خطأ",description:"تعذر تحميل بيانات الملف الشخصي",variant:"destructive"})}finally{j(!1)}})()},[s,c]),t.useEffect(()=>{a.siteTitle&&(document.title=a.siteTitle),a.language&&(document.documentElement.lang=a.language,document.body.dir=a.language==="ar"?"rtl":"ltr")},[a.siteTitle,a.language]);const H=async r=>{if(r.preventDefault(),N(null),o(null),i!==f){o("كلمة المرور الجديدة غير متطابقة");return}const n=R(i,a);if(n.length>0){o(n.join("، "));return}b(!0);try{const z=await L.post("/api/user/password",{currentPassword:x,newPassword:i});N("تم تغيير كلمة المرور بنجاح"),u(""),h(""),g(""),setTimeout(()=>{(s==null?void 0:s.role)==="head"?l("/dashboard"):l("/admin")},2e3)}catch{o("حدث خطأ أثناء تغيير كلمة المرور")}finally{b(!1)}};return k?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(T,{}),e.jsx("div",{className:"max-w-xl mx-auto px-4 sm:px-6 py-6 sm:py-10",children:e.jsxs(P,{children:[e.jsx(y,{children:e.jsx(C,{className:"text-lg sm:text-xl",children:"الملف الشخصي"})}),e.jsx(S,{children:e.jsx("p",{className:"text-sm sm:text-base",children:"جاري تحميل بيانات المستخدم..."})})]})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(T,{}),e.jsx("div",{className:"max-w-xl mx-auto px-4 sm:px-6 py-6 sm:py-10",children:e.jsxs(P,{children:[e.jsx(y,{children:e.jsx(C,{className:"text-lg sm:text-xl",children:"الملف الشخصي"})}),e.jsxs(S,{children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx(m,{className:"text-sm sm:text-base",children:"اسم المستخدم"}),e.jsx(d,{value:D.username,disabled:!0,className:"text-sm sm:text-base"})]}),e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsx(m,{htmlFor:"currentPassword",className:"text-sm sm:text-base",children:"كلمة المرور الحالية"}),e.jsx(d,{id:"currentPassword",type:"password",value:x,onChange:r=>u(r.target.value),required:!0,className:"text-sm sm:text-base"})]}),e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsx(m,{htmlFor:"newPassword",className:"text-sm sm:text-base",children:"كلمة المرور الجديدة"}),e.jsx(d,{id:"newPassword",type:"password",value:i,onChange:r=>h(r.target.value),required:!0,className:"text-sm sm:text-base"})]}),e.jsxs("div",{className:"mb-4 sm:mb-4",children:[e.jsx(m,{htmlFor:"confirmPassword",className:"text-sm sm:text-base",children:"تأكيد كلمة المرور الجديدة"}),e.jsx(d,{id:"confirmPassword",type:"password",value:f,onChange:r=>g(r.target.value),required:!0,className:"text-sm sm:text-base"})]}),v&&e.jsx("div",{className:"text-red-600 mb-3 text-sm sm:text-base",children:v}),w&&e.jsx("div",{className:"text-green-600 mb-3 text-sm sm:text-base",children:w}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsx(E,{type:"submit",disabled:p,className:"w-full sm:w-auto text-sm sm:text-base order-1 sm:order-1",children:p?"جاري الحفظ...":"تغيير كلمة المرور"}),e.jsx(E,{type:"button",variant:"outline",onClick:()=>{(s==null?void 0:s.role)==="head"?l("/dashboard"):l("/admin")},className:"w-full sm:w-auto text-sm sm:text-base order-2 sm:order-2",children:"العودة إلى لوحة التحكم"})]})]})]})]})})]})}export{M as default};
