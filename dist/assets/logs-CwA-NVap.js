import{r as x,c as N,b,j as e,C as i,e as w,f as v,d as c,I as S,S as C,m as k,n as A,p as P,q as m,P as o,B as p,O as T}from"./index-BRVCUzIT.js";import{a as u}from"./dropdown-menu-DdnnckdS.js";import{P as E,A as $}from"./page-wrapper-D2Xzdxb4.js";import"./index-uwi08Yf3.js";import"./file-text-Bxr2bFQ2.js";const h=20;function R(){const[r,n]=x.useState(1),[d,g]=x.useState(""),[l,f]=x.useState("all"),{data:t,isLoading:j}=N({queryKey:["/api/admin/logs",{page:r,search:d,type:l}],queryFn:async()=>{const s=new URLSearchParams;return s.append("page",String(r)),s.append("pageSize",String(h)),d&&s.append("search",d),l!=="all"&&s.append("type",l),(await T.get(`/api/admin/logs?${s.toString()}`)).data},keepPreviousData:!0}),{settings:a}=b();x.useEffect(()=>{a.siteTitle&&(document.title=a.siteTitle),a.language&&(document.documentElement.lang=a.language,document.body.dir=a.language==="ar"?"rtl":"ltr")},[a.siteTitle,a.language]);const y=Array.from(new Set(t==null?void 0:t.map(s=>s.type).filter(Boolean)));return e.jsx(E,{children:e.jsx("div",{className:"container mx-auto p-4 sm:p-6 space-y-4 sm:space-y-6",children:e.jsxs(i,{children:[e.jsx(w,{children:e.jsxs(v,{className:"text-lg sm:text-xl",children:[e.jsx($,{className:"inline-block ml-2 h-5 w-5 sm:h-6 sm:w-6"}),"سجل النشاطات"]})}),e.jsxs(c,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsx(S,{placeholder:"بحث في الرسائل أو المستخدم...",value:d,onChange:s=>{n(1),g(s.target.value)},className:"w-full sm:max-w-xs"}),e.jsxs(C,{value:l,onValueChange:s=>{n(1),f(s)},children:[e.jsx(k,{className:"w-full sm:max-w-xs",children:e.jsx(A,{placeholder:"كل الأنواع"})}),e.jsxs(P,{children:[e.jsx(m,{value:"all",children:"كل الأنواع"}),y.map(s=>e.jsx(m,{value:s,children:s},s))]})]})]}),j?e.jsx("div",{className:"text-center py-8 sm:py-12 text-muted-foreground",children:"جاري تحميل السجلات..."}):t&&t.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto rounded-lg border border-border",children:e.jsxs("table",{className:"min-w-full bg-card",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 lg:px-4 py-2 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"#"}),e.jsx("th",{className:"px-3 lg:px-4 py-2 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"النوع"}),e.jsx("th",{className:"px-3 lg:px-4 py-2 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"الرسالة"}),e.jsx("th",{className:"px-3 lg:px-4 py-2 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-3 lg:px-4 py-2 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"التاريخ"})]})}),e.jsx("tbody",{className:"bg-card divide-y divide-border",children:t.map(s=>e.jsxs("tr",{className:"hover:bg-muted",children:[e.jsx("td",{className:"px-3 lg:px-4 py-2 text-sm text-foreground",children:s.id}),e.jsx("td",{className:"px-3 lg:px-4 py-2",children:e.jsx(u,{variant:"secondary",className:"text-xs",children:s.type})}),e.jsx("td",{className:"px-3 lg:px-4 py-2 text-sm text-foreground max-w-xs truncate",children:s.message}),e.jsx("td",{className:"px-3 lg:px-4 py-2 text-sm text-foreground",children:s.user?`${s.user.username} (${s.user.role==="root"?"مشرف رئيسي":s.user.role==="admin"?"مشرف":"مستخدم"})`:"—"}),e.jsx("td",{className:"px-3 lg:px-4 py-2 text-sm text-muted-foreground",children:o(s.createdAt)})]},s.id))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:t.map(s=>e.jsx(i,{className:"border border-border",children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{variant:"secondary",className:"text-xs",children:s.type}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["#",s.id]})]}),e.jsx("p",{className:"text-sm text-foreground break-words",children:s.message}),e.jsxs("div",{className:"flex flex-col xs:flex-row xs:items-center justify-between gap-1 xs:gap-2 pt-2 border-t border-border",children:[e.jsx("span",{className:"text-xs text-foreground",children:s.user?`${s.user.username} (${s.user.role==="root"?"مشرف رئيسي":s.user.role==="admin"?"مشرف":"مستخدم"})`:"—"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:o(s.createdAt)})]})]})})},s.id))})]}):e.jsx("div",{className:"text-center py-8 sm:py-12 text-muted-foreground",children:"لا توجد سجلات."}),e.jsxs("div",{className:"flex flex-col xs:flex-row justify-center items-center gap-3 xs:gap-4 mt-4 sm:mt-6",children:[e.jsx(p,{variant:"outline",disabled:r===1,onClick:()=>n(s=>Math.max(1,s-1)),className:"w-full xs:w-auto text-sm",children:"السابق"}),e.jsxs("span",{className:"text-sm sm:text-base text-foreground order-first xs:order-none",children:["صفحة ",r]}),e.jsx(p,{variant:"outline",disabled:!t||t.length<h,onClick:()=>n(s=>s+1),className:"w-full xs:w-auto text-sm",children:"التالي"})]})]})]})})})}export{R as default};
