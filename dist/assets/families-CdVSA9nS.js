import{j as e,Z as n,C as D,d as A,e as O,r as o,a as js,t as Ns,b as ws,c as Ee,w as ys,O as Le,g as Ne,i as V,U as xe,f as we,I as ye,S,m as W,n as B,p as M,q as i,P as Je,B as k,L as vs,y as me,M as Re,N as Ge,s as ks,o as Ds,k as As,h as Cs}from"./index-BRVCUzIT.js";import{a as w}from"./dropdown-menu-DdnnckdS.js";import{D as Is,a as Ts,b as Hs,c as Fs}from"./dialog-D51Jx8ed.js";import{E as Ss}from"./exceljs.min-Cz8xvZTz.js";import{P as ze}from"./page-wrapper-D2Xzdxb4.js";import{M as Ws}from"./map-pin-CJflmUvF.js";import{S as Bs}from"./search-DbNGpwvW.js";import{P as Ms}from"./phone-FUN1W9cr.js";import{E as Ps}from"./eye-Bk7S5FeN.js";import{P as $s,T as Es}from"./trash-2-a2eIXDOS.js";import{F as Ls}from"./file-text-Bxr2bFQ2.js";import{F as _e}from"./file-spreadsheet-Bd2LZWmb.js";import"./index-uwi08Yf3.js";function Js(){return e.jsxs("div",{className:"space-y-6 max-w-full min-w-0",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(n,{className:"h-8 w-48 mb-2"}),e.jsx(n,{className:"h-4 w-80"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:Array.from({length:4}).map((q,N)=>e.jsx(D,{children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(n,{className:"h-12 w-12 rounded-lg"}),e.jsxs("div",{className:"mr-4 space-y-2",children:[e.jsx(n,{className:"h-3 w-20"}),e.jsx(n,{className:"h-6 w-12"})]})]})})},N))}),e.jsxs(D,{className:"mb-8",children:[e.jsx(O,{children:e.jsx(n,{className:"h-5 w-32"})}),e.jsx(A,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"relative w-full max-w-md",children:e.jsx(n,{className:"h-10 w-full rounded-md"})})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Array.from({length:4}).map((q,N)=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(n,{className:"h-4 w-16 mb-1"}),e.jsx(n,{className:"h-10 w-full rounded-md"})]},N))})]})})]}),e.jsxs(D,{children:[e.jsx(O,{children:e.jsx(n,{className:"h-5 w-40"})}),e.jsx(A,{children:e.jsxs("div",{className:"overflow-x-auto max-w-full",children:[e.jsxs("div",{className:"w-full min-w-full",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-4 py-3 border-b",children:[e.jsx(n,{className:"h-4 w-20"}),e.jsx(n,{className:"h-4 w-24"}),e.jsx(n,{className:"h-4 w-20"}),e.jsx(n,{className:"h-4 w-16"}),e.jsx(n,{className:"h-4 w-20"}),e.jsx(n,{className:"h-4 w-16"})]}),Array.from({length:10}).map((q,N)=>e.jsxs("div",{className:"grid grid-cols-6 gap-4 py-4 border-b hover:bg-muted",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"h-4 w-32"}),e.jsx(n,{className:"h-3 w-24"})]}),e.jsx(n,{className:"h-4 w-24"}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx(n,{className:"h-4 w-8 mx-auto"}),e.jsx(n,{className:"h-3 w-20 mx-auto"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx(n,{className:"h-5 w-12 rounded-full"}),e.jsx(n,{className:"h-5 w-12 rounded-full"})]}),e.jsx(n,{className:"h-4 w-20"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(n,{className:"h-8 w-8 rounded"}),e.jsx(n,{className:"h-8 w-8 rounded"}),e.jsx(n,{className:"h-8 w-8 rounded"}),e.jsx(n,{className:"h-8 w-8 rounded"})]})]},N))]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{className:"h-8 w-16"}),e.jsx(n,{className:"h-8 w-16"})]}),e.jsx(n,{className:"h-4 w-32"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{className:"h-8 w-16"}),e.jsx(n,{className:"h-8 w-16"})]})]})]})})]}),e.jsxs(D,{className:"mb-6 max-w-full",children:[e.jsxs(O,{children:[e.jsx(n,{className:"h-5 w-48"}),e.jsx(n,{className:"h-4 w-80 mt-2"})]}),e.jsxs(A,{className:"max-w-full overflow-hidden",children:[e.jsxs("div",{className:"flex gap-2 mb-2 justify-end flex-wrap",children:[e.jsx(n,{className:"h-9 w-20"}),e.jsx(n,{className:"h-9 w-24"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 mb-4",children:Array.from({length:12}).map((q,N)=>e.jsx(n,{className:"h-12 w-full rounded-lg"},N))}),e.jsx("div",{className:"flex justify-end",children:e.jsx(n,{className:"h-12 w-40 rounded-lg"})})]})]})]})}const ta=o.memo(function(){const[N,Ve]=o.useState(""),[P,Oe]=o.useState(null),[Ue,ve]=o.useState(!1),[C,Q]=o.useState(1),ue=10,[,Ye]=js(),{toast:Z}=Ns(),[X,qe]=o.useState("all"),[K,Qe]=o.useState("all"),[ee,Ze]=o.useState("all"),[se,Xe]=o.useState("all"),[ae,Ke]=o.useState("all"),[te,es]=o.useState("all"),[H,ss]=o.useState("all"),[R,as]=o.useState("all"),[re,ts]=o.useState(""),[le,rs]=o.useState(""),{settings:$}=ws();o.useEffect(()=>{$.siteTitle&&(document.title=$.siteTitle),$.language&&(document.documentElement.lang=$.language,document.body.dir=$.language==="ar"?"rtl":"ltr")},[$.siteTitle,$.language]);const ke=s=>{if(!s)return 0;const a=new Date,c=new Date(s);let g=a.getFullYear()-c.getFullYear();const b=a.getMonth()-c.getMonth();return(b<0||b===0&&a.getDate()<c.getDate())&&g--,g},ls=s=>s.isAbroad?s.abroadLocation||"مغترب بالخارج":s.isDisplaced?"نازح":"مقيم",{data:m,isLoading:ns}=Ee({queryKey:["/api/admin/families"]}),{data:r,isLoading:is,error:De}=Ee({queryKey:["/api/admin/families",P==null?void 0:P.id],enabled:!!(P!=null&&P.id),queryFn:async()=>{const a=(await Le.get(`/api/admin/families/${P.id}`)).data,c=a.userGender||"male";return a.spouse?c==="female"?(a.spouseAsHusbandName=a.spouse.husbandName||a.spouse.wifeName,a.spouseAsHusbandID=a.spouse.husbandID||a.spouse.wifeID,a.spouseAsHusbandBirthDate=a.spouse.husbandBirthDate||a.spouse.wifeBirthDate,a.spouseAsHusbandJob=a.spouse.husbandJob||a.spouse.wifeJob,a.spouseAsHusbandPregnant=a.spouse.husbandPregnant||a.spouse.wifePregnant,a.spouseAsHusbandHasChronicIllness=a.spouse.husbandHasChronicIllness||a.spouse.wifeHasChronicIllness,a.spouseAsHusbandChronicIllnessType=a.spouse.husbandChronicIllnessType||a.spouse.wifeChronicIllnessType,a.spouseAsHusbandHasDisability=a.spouse.husbandHasDisability||a.spouse.wifeHasDisability,a.spouseAsHusbandDisabilityType=a.spouse.husbandDisabilityType||a.spouse.wifeDisabilityType):(a.spouseAsWifeName=a.spouse.wifeName,a.spouseAsWifeID=a.spouse.wifeID,a.spouseAsWifeBirthDate=a.spouse.wifeBirthDate,a.spouseAsWifeJob=a.spouse.wifeJob,a.spouseAsWifePregnant=a.spouse.wifePregnant,a.spouseAsWifeHasChronicIllness=a.spouse.wifeHasChronicIllness,a.spouseAsWifeChronicIllnessType=a.spouse.wifeChronicIllnessType,a.spouseAsWifeHasDisability=a.spouse.wifeHasDisability,a.spouseAsWifeDisabilityType=a.spouse.wifeDisabilityType):a.wifeName&&(c==="female"?(a.spouseAsHusbandName=a.wifeName,a.spouseAsHusbandID=a.wifeID,a.spouseAsHusbandBirthDate=a.wifeBirthDate,a.spouseAsHusbandJob=a.wifeJob,a.spouseAsHusbandPregnant=a.wifePregnant,a.spouseAsHusbandHasChronicIllness=a.wifeHasChronicIllness,a.spouseAsHusbandChronicIllnessType=a.wifeChronicIllnessType,a.spouseAsHusbandHasDisability=a.wifeHasDisability,a.spouseAsHusbandDisabilityType=a.wifeDisabilityType):(a.spouseAsWifeName=a.wifeName,a.spouseAsWifeID=a.wifeID,a.spouseAsWifeBirthDate=a.wifeBirthDate,a.spouseAsWifeJob=a.wifeJob,a.spouseAsWifePregnant=a.wifePregnant,a.spouseAsWifeHasChronicIllness=a.wifeHasChronicIllness,a.spouseAsWifeChronicIllnessType=a.wifeChronicIllnessType,a.spouseAsWifeHasDisability=a.wifeHasDisability,a.spouseAsWifeDisabilityType=a.wifeDisabilityType)),a}}),cs=ys({mutationFn:async s=>(await Le.delete(`/api/admin/families/${s}`),s),onSuccess:()=>{Z({title:"تم حذف الأسرة",description:"تم حذف الأسرة بنجاح"}),window.location.reload()},onError:s=>{Z({title:"خطأ في الحذف",description:s.message,variant:"destructive"})}});o.useMemo(()=>Array.from(new Set((m||[]).map(s=>s.branch).filter(Boolean))),[m]);const I=o.useMemo(()=>Array.isArray(m)?m.filter(s=>{var z;const a=N.toLowerCase(),c=s.husbandName.toLowerCase(),g=Ne(s.branch),b=(g==null?void 0:g.toLowerCase())||"",j=c.includes(a)||s.husbandID.includes(N)||b.includes(a),F=X==="all"||s.branch===X,G=K==="all"||(K==="yes"?s.isDisplaced:!s.isDisplaced),E=ee==="all"||(ee==="yes"?s.warDamage2023:!s.warDamage2023),L=se==="all"||(se==="yes"?s.isAbroad:!s.isAbroad),be=ae==="all"||s.socialStatus===ae,de=R==="all"||R==="small"&&s.totalMembers<=3||R==="medium"&&s.totalMembers>3&&s.totalMembers<=6||R==="large"&&s.totalMembers>6,je=te==="all"||(te==="yes"?s.wifePregnant:!s.wifePregnant),T=((z=s.members)==null?void 0:z.filter(t=>{if(!t.birthDate)return!1;const f=new Date,x=new Date(t.birthDate);let u=f.getFullYear()-x.getFullYear();const d=f.getMonth()-x.getMonth();return(d<0||d===0&&f.getDate()<x.getDate())&&u--,u<2}))||[],oe=H==="all"||(H==="yes"?T.length>0:T.length===0)||H==="many"&&T.length>=3||H==="few"&&T.length>0&&T.length<3||H==="custom"&&(re===""||T.length>=parseInt(re))&&(le===""||T.length<=parseInt(le));return j&&F&&G&&E&&L&&be&&de&&je&&oe}):[],[m,N,X,K,ee,se,ae,te,H,R,re,le]),{maxSons:ne,maxChildren:ie,maxWives:Ae}=o.useMemo(()=>{const s=Array.isArray(I)?I:[];if(s.length===0)return{maxSons:0,maxChildren:0,maxWives:0};let a=0,c=0,g=0;return s.forEach(b=>{const j=Array.isArray(b.members)?b.members:[],F=j.filter(L=>!V(L.birthDate)).length,G=j.filter(L=>V(L.birthDate)).length,E=b.wife||b.wifeName?1:0;F>a&&(a=F),G>c&&(c=G),E>g&&(g=E)}),{maxSons:a,maxChildren:c,maxWives:g}},[I]),h=o.useMemo(()=>[{key:"husbandName",label:"اسم رب/ربة الأسرة رباعي",checked:!0},{key:"husbandID",label:"رقم هوية رب/ربة الأسرة",checked:!0},{key:"husbandJob",label:"عمل رب/ربة الأسرة",checked:!0},{key:"husbandBirthDate",label:"تاريخ ميلاد رب/ربة الأسرة",checked:!0},{key:"husbandAge",label:"عمر رب/ربة الأسرة",checked:!0},{key:"hasChronicIllness",label:"هل يعاني رب الأسرة من مرض مزمن",checked:!0},{key:"chronicIllnessType",label:"نوع مرض رب الأسرة المزمن",checked:!0},{key:"hasDisability",label:"هل يعاني رب الأسرة من إعاقة",checked:!0},{key:"disabilityType",label:"نوع إعاقة رب الأسرة",checked:!0},...Ae>0?[{key:"wifeName",label:"اسم الزوج/ة رباعي",checked:!0},{key:"wifeID",label:"رقم هوية الزوج/ة",checked:!0},{key:"wifeJob",label:"عمل الزوج/ة",checked:!0},{key:"wifeBirthDate",label:"تاريخ ميلاد الزوج/ة",checked:!0},{key:"wifeAge",label:"عمر الزوج/ة",checked:!0},{key:"wifePregnant",label:"هل الزوج/ة حامل",checked:!0},{key:"wifeHasChronicIllness",label:"هل يعاني/تعاني الزوج/ة من مرض مزمن",checked:!0},{key:"wifeChronicIllnessType",label:"نوع مرض الزوج/ة المزمن",checked:!0},{key:"wifeHasDisability",label:"هل يعاني/تعاني الزوج/ة من إعاقة",checked:!0},{key:"wifeDisabilityType",label:"نوع إعاقة الزوج/ة",checked:!0}]:[],{key:"primaryPhone",label:"رقم الجوال للتواصل",checked:!0},{key:"secondaryPhone",label:"رقم الجوال البديل",checked:!0},{key:"originalResidence",label:"السكن الأصلي",checked:!0},{key:"currentHousing",label:"حالة السكن الحالي",checked:!0},{key:"displacedLocation",label:"اقرب معلم لك في حال كنت نازح حاليا",checked:!0},{key:"warDamageDescription",label:"الاضرار الناجمة عن حرب 2023",checked:!0},{key:"branch",label:"الفرع",checked:!0},{key:"totalMembers",label:"عدد افراد الأسرة مع الأب والأم",checked:!0},{key:"hasDisabledMembers",label:"هل يوجد افراد ذوي اعاقة في العائلة",checked:!0},{key:"disabilityTypes",label:"اذا كان يوجد أشخاص ذوي اعاقة اذكر نوع الإعاقة",checked:!0},{key:"hasChildrenUnderTwo",label:"هل لديك ابناء اقل من سنتين",checked:!0},...ne>0?Array.from({length:ne}).flatMap((s,a)=>[{key:`sonName${a+1}`,label:`اسم الابن ${a+1}`,checked:!0},{key:`sonID${a+1}`,label:`رقم هوية الابن ${a+1}`,checked:!0},{key:`sonBirthDate${a+1}`,label:"تاريخ الميلاد",checked:!0}]):[],...ie>0?Array.from({length:ie}).flatMap((s,a)=>[{key:`childName${a+1}`,label:`اسم الطفل رباعي ${a+1}`,checked:!0},{key:`childID${a+1}`,label:`رقم هوية الطفل ${a+1}`,checked:!0},{key:`childBirthDate${a+1}`,label:"تاريخ الميلاد",checked:!0}]):[],{key:"hasChildrenAboveTwo",label:"هل لديك ابناء أكبر من سنتين",checked:!0},{key:"numMales",label:"عدد الافراد الذكور",checked:!0},{key:"numFemales",label:"عدد الافراد الاناث",checked:!0},{key:"socialStatus",label:"الحالة الاجتماعية لرب الاسرة",checked:!0},{key:"abroadLocation",label:"اسم الدولة إذا كنت مغترب خارج البلاد",checked:!0},{key:"adminNotes",label:"ملاحظات إدارية",checked:!0}],[ne,ie,Ae]),[y,U]=o.useState({});o.useEffect(()=>{U(s=>{const a={};for(const c of h)a[c.key]=s[c.key]!==void 0?s[c.key]:!0;return a})},[h]);const pe=s=>{U(a=>({...a,[s]:!a[s]}))},Ce=s=>{U(a=>{const c={...a},g=h.filter(j=>s==="sons"?j.key.startsWith("son"):j.key.startsWith("child")),b=g.every(j=>a[j.key]);for(const j of g)c[j.key]=!b;return c})},ds=()=>{U(Object.fromEntries(h.map(s=>[s.key,!0])))},os=()=>{U(Object.fromEntries(h.map(s=>[s.key,!1])))},ge=h.filter(s=>s.key.startsWith("son")),fe=h.filter(s=>s.key.startsWith("child")),Ie=h.filter(s=>s.key.startsWith("wife"));h.filter(s=>s.key.startsWith("husband"));const Te=ge.length>0&&ge.every(s=>y[s.key]),He=fe.length>0&&fe.every(s=>y[s.key]);Ie.length>0&&Ie.every(s=>y[s.key]);const Y=h.filter(s=>y[s.key]),hs=async()=>{try{const s=new Ss.Workbook,a=s.addWorksheet("قائمة الأسر",{views:[{rightToLeft:!0}]}),c={fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FF4CAF50"}},font:{color:{argb:"FFFFFFFF"},bold:!0,size:16},alignment:{horizontal:"center",vertical:"middle"}},g={fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FF4CAF50"}},font:{color:{argb:"FFFFFFFF"},bold:!0,size:12},alignment:{horizontal:"center",vertical:"middle",wrapText:!0},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}},b={alignment:{horizontal:"center",vertical:"middle",wrapText:!0},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}},j=Array(Y.length).fill("");j[0]="قائمة الأسر (تصدير)";const F=a.addRow(j);F.height=30;const G=a.getColumn(Y.length).letter;a.mergeCells(`A1:${G}1`),F.getCell(1).style=c,F.getCell(1).alignment={horizontal:"center",vertical:"middle"};const E=a.addRow(Y.map(t=>t.label));E.height=30,E.eachCell(t=>{t.style=g,t.alignment={...g.alignment,wrapText:!0}}),(Array.isArray(I)?I:[]).forEach(t=>{const f=Array.isArray(t==null?void 0:t.members)?t.members:[];console.log("Exporting family:",{id:t.id,husbandName:t.husbandName,members:f,sons:f.filter(l=>!V(l.birthDate)).map(l=>({fullName:l.fullName,birthDate:l.birthDate})),children:f.filter(l=>V(l.birthDate)).map(l=>({fullName:l.fullName,birthDate:l.birthDate}))});const x=Array.isArray(f)?f.filter(l=>V(l.birthDate)):[],u=Array.isArray(f)?f.filter(l=>!V(l.birthDate)):[],d=t.wife?[t.wife]:t.wifeName?[{wifeName:t.wifeName,wifeID:t.wifeID,wifeJob:t.wifeJob,wifeBirthDate:t.wifeBirthDate,wifePregnant:t.wifePregnant,wifeHasChronicIllness:t.wifeHasChronicIllness,wifeChronicIllnessType:t.wifeChronicIllnessType,wifeHasDisability:t.wifeHasDisability,wifeDisabilityType:t.wifeDisabilityType}]:[],Rs=Array.isArray(u)?Array.from({length:ne}).map((l,_)=>u[_]||null):[],Gs=Array.isArray(x)?Array.from({length:ie}).map((l,_)=>x[_]||null):[],zs=d.length>0?[d[0]]:[null],he=Array.isArray(f)?f.filter(l=>l.isDisabled):[],bs=Array.isArray(he)?he.map(l=>l.disabilityType||"").filter(Boolean).join(", "):"",Fe=Array.isArray(Y)?Y.map(l=>{if(l.key==="wifeName")return d.length>0&&d[0].wifeName||"";if(l.key==="wifeID")return d.length>0&&d[0].wifeID||"";if(l.key==="wifeJob")return d.length>0&&d[0].wifeJob||"";if(l.key==="wifeBirthDate")return d.length>0&&d[0].wifeBirthDate||"";if(l.key==="wifeAge")return d.length>0&&d[0].wifeBirthDate?ke(d[0].wifeBirthDate):"";if(l.key==="wifePregnant")return d.length>0?d[0].wifePregnant?"نعم":"لا":"";if(l.key==="wifeHasChronicIllness")return d.length>0?d[0].wifeHasChronicIllness?"نعم":"لا":"";if(l.key==="wifeChronicIllnessType")return d.length>0&&d[0].wifeChronicIllnessType||"";if(l.key==="wifeHasDisability")return d.length>0?d[0].wifeHasDisability?"نعم":"لا":"";if(l.key==="wifeDisabilityType")return d.length>0&&d[0].wifeDisabilityType||"";const _=typeof l.key=="string"?l.key.match(/^sonName(\d+)$/):null,We=typeof l.key=="string"?l.key.match(/^sonID(\d+)$/):null,Be=typeof l.key=="string"?l.key.match(/^sonBirthDate(\d+)$/):null;if(_){const p=parseInt(_[1],10)-1;if(Array.isArray(u)&&u[p]){const v=u[p];let J=v.fullName||"";return v.isDisabled&&(J+=` (إعاقة: ${v.disabilityType||"محدد"})`),v.hasChronicIllness&&(J+=` (مرض مزمن: ${v.chronicIllnessType||"محدد"})`),J}return""}if(We){const p=parseInt(We[1],10)-1;return Array.isArray(u)&&u[p]&&u[p].memberID||""}if(Be){const p=parseInt(Be[1],10)-1;return Array.isArray(u)&&u[p]&&u[p].birthDate||""}const Me=typeof l.key=="string"?l.key.match(/^childName(\d+)$/):null,Pe=typeof l.key=="string"?l.key.match(/^childID(\d+)$/):null,$e=typeof l.key=="string"?l.key.match(/^childBirthDate(\d+)$/):null;if(Me){const p=parseInt(Me[1],10)-1;if(Array.isArray(x)&&x[p]){const v=x[p];let J=v.fullName||"";return v.isDisabled&&(J+=` (إعاقة: ${v.disabilityType||"محدد"})`),v.hasChronicIllness&&(J+=` (مرض مزمن: ${v.chronicIllnessType||"محدد"})`),J}return""}if(Pe){const p=parseInt(Pe[1],10)-1;return Array.isArray(x)&&x[p]&&x[p].memberID||""}if($e){const p=parseInt($e[1],10)-1;return Array.isArray(x)&&x[p]&&x[p].birthDate||""}switch(l.key){case"husbandName":return t.husbandName||"";case"husbandID":return t.husbandID||"";case"husbandJob":return t.husbandJob||"";case"husbandBirthDate":return t.husbandBirthDate||"";case"husbandAge":return t.husbandBirthDate?ke(t.husbandBirthDate):"";case"hasChronicIllness":return t.hasChronicIllness?"نعم":"لا";case"chronicIllnessType":return t.chronicIllnessType||"";case"hasDisability":return t.hasDisability?"نعم":"لا";case"disabilityType":return t.disabilityType||"";case"primaryPhone":return t.primaryPhone||"";case"secondaryPhone":return t.secondaryPhone||"";case"originalResidence":return t.originalResidence||"";case"currentHousing":return ls(t);case"displacedLocation":return t.displacedLocation||"";case"warDamageDescription":return Cs(t.warDamageDescription)||"";case"branch":return Ne(t.branch)||"";case"totalMembers":return t.totalMembers||"";case"hasDisabledMembers":return Array.isArray(he)&&he.length>0?"نعم":"لا";case"disabilityTypes":return bs;case"hasChildrenUnderTwo":return Array.isArray(x)&&x.length>0?"نعم":"لا";case"hasChildrenAboveTwo":return Array.isArray(u)&&u.length>0?"نعم":"لا";case"numMales":return t.numMales||"";case"numFemales":return t.numFemales||"";case"socialStatus":return t.socialStatus?As(t.socialStatus):"";case"abroadLocation":return t.abroadLocation||"";case"adminNotes":return t.adminNotes||"";default:return""}}):[];console.log("Excel rowData:",{familyId:t.id,husbandName:t.husbandName,rowData:Fe,sons:u,children:x});const Se=a.addRow(Fe);Se.height=25,Se.eachCell(l=>{l.style=b,l.alignment={...b.alignment,wrapText:!0}})});const L=t=>t.includes("Name")||t.includes("name")||t.includes("اسم")||t.includes("Notes")||t.includes("ملاحظات")||t.includes("originalResidence")||t.includes("displacedLocation")||t.includes("warDamageDescription")||t.includes("disabilityTypes")||t.includes("abroadLocation")?40:t.includes("Job")||t.includes("عمل")||t.includes("branch")||t.includes("فرع")||t.includes("currentHousing")||t.includes("socialStatus")?28:t.includes("Phone")||t.includes("جوال")?24:t.includes("ID")||t.includes("هوية")||t.includes("BirthDate")||t.includes("ميلاد")||t.includes("Age")||t.includes("عمر")?20:t.includes("num")||t.includes("عدد")||t.includes("total")||t.includes("has")||t.includes("Pregnant")||t.includes("حامل")?18:22,be=h.filter(t=>y[t.key]);a.columns.forEach((t,f)=>{const x=be[f];x?t.width=L(x.key):t.width=20});const de=`families_export_${new Date().toISOString().split("T")[0]}.xlsx`,je=await s.xlsx.writeBuffer(),T=new Blob([je],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),oe=window.URL.createObjectURL(T),z=document.createElement("a");z.href=oe,z.download=de,z.click(),window.URL.revokeObjectURL(oe),Z({title:"تم التصدير بنجاح",description:`تم حفظ ملف Excel باسم: ${de}`,variant:"default"})}catch{Z({title:"خطأ في التصدير",description:"حدث خطأ أثناء تصدير البيانات إلى Excel",variant:"destructive"})}},ce=Math.ceil(I.length/ue),xs=I.slice((C-1)*ue,C*ue),ms=s=>{Oe(s),ve(!0)};if(ns)return e.jsx(ze,{children:e.jsx(Js,{})});const us=(m==null?void 0:m.length)||0,ps=(m==null?void 0:m.filter(s=>s.isDisplaced))||[],gs=(m==null?void 0:m.filter(s=>s.warDamage2023))||[],fs=(m==null?void 0:m.filter(s=>s.isAbroad))||[];return e.jsx(ze,{children:e.jsxs("div",{className:"space-y-6 w-full min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"إدارة الأسر"}),e.jsx("p",{className:"text-muted-foreground",children:"عرض وإدارة بيانات جميع الأسر المسجلة"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(D,{children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(xe,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي الأسر"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:us})]})]})})}),e.jsx(D,{children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-destructive/10 rounded-lg",children:e.jsx(Ws,{className:"h-6 w-6 text-destructive"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"أسر نازحة"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:ps.length})]})]})})}),e.jsx(D,{children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-warning/10 rounded-lg",children:e.jsx(xe,{className:"h-6 w-6 text-warning"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"أسر متضررة"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:gs.length})]})]})})}),e.jsx(D,{children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-secondary/10 rounded-lg",children:e.jsx(xe,{className:"h-6 w-6 text-secondary"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"مغتربون"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:fs.length})]})]})})})]}),e.jsxs(D,{className:"mb-8",children:[e.jsx(O,{children:e.jsx(we,{children:"البحث والتصفية"})}),e.jsx(A,{children:e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative w-full max-w-md",children:[e.jsx(Bs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ye,{placeholder:"البحث بالاسم، رقم الهوية، أو الموقع...",value:N,onChange:s=>Ve(s.target.value),className:"pl-10 text-right",dir:"rtl"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"الفرع"}),e.jsxs(S,{value:X,onValueChange:qe,dir:"rtl",children:[e.jsx(W,{className:"w-full text-right",dir:"rtl",children:e.jsx(B,{className:"text-right"})}),e.jsxs(M,{dir:"rtl",children:[e.jsx(i,{value:"all",children:"كل الفروع"}),e.jsx(i,{value:"abushalbia",children:"ابو شلبية (شلف - علاينة - عزايزة)"}),e.jsx(i,{value:"alnaqra",children:"النقرة (الدوار)"}),e.jsx(i,{value:"abuawda",children:"ابو عودة"}),e.jsx(i,{value:"abunasr",children:"ابو نصر"}),e.jsx(i,{value:"abumatar",children:"ابو مطر"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"نازح"}),e.jsxs(S,{value:K,onValueChange:Qe,dir:"rtl",children:[e.jsx(W,{className:"w-full text-right",dir:"rtl",children:e.jsx(B,{className:"text-right"})}),e.jsxs(M,{dir:"rtl",children:[e.jsx(i,{value:"all",children:"كل الحالات"}),e.jsx(i,{value:"yes",children:"نازح"}),e.jsx(i,{value:"no",children:"غير نازح"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"متضرر"}),e.jsxs(S,{value:ee,onValueChange:Ze,dir:"rtl",children:[e.jsx(W,{className:"w-full text-right",dir:"rtl",children:e.jsx(B,{className:"text-right"})}),e.jsxs(M,{dir:"rtl",children:[e.jsx(i,{value:"all",children:"كل الحالات"}),e.jsx(i,{value:"yes",children:"متضرر"}),e.jsx(i,{value:"no",children:"غير متضرر"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"مغترب"}),e.jsxs(S,{value:se,onValueChange:Xe,dir:"rtl",children:[e.jsx(W,{className:"w-full text-right",dir:"rtl",children:e.jsx(B,{className:"text-right"})}),e.jsxs(M,{dir:"rtl",children:[e.jsx(i,{value:"all",children:"كل الحالات"}),e.jsx(i,{value:"yes",children:"مغترب"}),e.jsx(i,{value:"no",children:"غير مغترب"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"الحالة الاجتماعية"}),e.jsxs(S,{value:ae,onValueChange:Ke,dir:"rtl",children:[e.jsx(W,{className:"w-full text-right",dir:"rtl",children:e.jsx(B,{className:"text-right"})}),e.jsxs(M,{dir:"rtl",children:[e.jsx(i,{value:"all",children:"جميع الحالات"}),e.jsx(i,{value:"married",children:"متزوج"}),e.jsx(i,{value:"polygamous",children:"متعدد زوجات"}),e.jsx(i,{value:"widowed",children:"ارملة"}),e.jsx(i,{value:"vulnerable_family",children:"اسر هشة (ايتام)"}),e.jsx(i,{value:"abandoned",children:"متروكة"}),e.jsx(i,{value:"divorced",children:"مطلقة"}),e.jsx(i,{value:"single",children:"عانس"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"عدد الأفراد"}),e.jsxs(S,{value:R,onValueChange:as,dir:"rtl",children:[e.jsx(W,{className:"w-full text-right",dir:"rtl",children:e.jsx(B,{className:"text-right"})}),e.jsxs(M,{dir:"rtl",children:[e.jsx(i,{value:"all",children:"جميع الأحجام"}),e.jsx(i,{value:"small",children:"صغيرة (1-3)"}),e.jsx(i,{value:"medium",children:"متوسطة (4-6)"}),e.jsx(i,{value:"large",children:"كبيرة (7+)"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"أم حامل"}),e.jsxs(S,{value:te,onValueChange:es,dir:"rtl",children:[e.jsx(W,{className:"w-full text-right",dir:"rtl",children:e.jsx(B,{className:"text-right"})}),e.jsxs(M,{dir:"rtl",children:[e.jsx(i,{value:"all",children:"جميع الحالات"}),e.jsx(i,{value:"yes",children:"نعم"}),e.jsx(i,{value:"no",children:"لا"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"عدد الأطفال"}),e.jsxs(S,{value:H,onValueChange:ss,dir:"rtl",children:[e.jsx(W,{className:"w-full text-right",dir:"rtl",children:e.jsx(B,{className:"text-right"})}),e.jsxs(M,{dir:"rtl",children:[e.jsx(i,{value:"all",children:"جميع الحالات"}),e.jsx(i,{value:"yes",children:"نعم"}),e.jsx(i,{value:"no",children:"لا"}),e.jsx(i,{value:"many",children:"كثير (3+)"}),e.jsx(i,{value:"few",children:"قليل (1-2)"}),e.jsx(i,{value:"custom",children:"مخصص"})]})]}),H==="custom"&&e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 w-full",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground block text-center",children:"الحد الأدنى"}),e.jsx(ye,{type:"number",min:"0",value:re,onChange:s=>ts(s.target.value),placeholder:"0",className:"text-xs text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground block text-center",children:"الحد الأقصى"}),e.jsx(ye,{type:"number",min:"0",value:le,onChange:s=>rs(s.target.value),placeholder:"10",className:"text-xs text-right"})]})]})]})]})]})})]}),e.jsxs(D,{children:[e.jsx(O,{children:e.jsxs(we,{children:["قائمة الأسر (",I.length,")"]})}),e.jsx(A,{children:I.length>0?e.jsxs("div",{className:"overflow-x-auto w-full",children:[e.jsxs("table",{className:"w-full min-w-[800px]",children:[e.jsx("thead",{className:"bg-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 md:px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"رب الأسرة"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"رقم الهوية"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"أفراد الأسرة"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider hidden lg:table-cell",children:"تاريخ التسجيل"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"bg-card divide-y divide-border",children:xs.map(s=>e.jsxs("tr",{className:"hover:bg-muted",children:[e.jsx("td",{className:"px-3 md:px-6 py-4",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-foreground truncate",children:s.husbandName}),s.primaryPhone&&e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center truncate",children:[e.jsx(Ms,{className:"h-3 w-3 ml-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.primaryPhone})]})]})}),e.jsx("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-sm text-foreground",children:s.husbandID}),e.jsxs("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-center",children:[e.jsx("div",{className:"text-sm font-medium text-foreground",children:s.totalMembers||0}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.numMales||0," ذكور، ",s.numFemales||0," إناث"]})]}),e.jsx("td",{className:"px-3 md:px-6 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-[120px]",children:[s.isDisplaced&&e.jsx(w,{variant:"destructive",className:"text-xs",children:"نازح"}),s.warDamage2023&&e.jsx(w,{variant:"outline",className:"text-xs",children:"متضرر"}),s.isAbroad&&e.jsx(w,{className:"bg-primary/10 text-primary text-xs",children:"مغترب"})]})}),e.jsx("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-sm text-muted-foreground hidden lg:table-cell",children:Je(s.createdAt)}),e.jsx("td",{className:"px-3 md:px-6 py-4 text-sm",children:e.jsxs("div",{className:"flex flex-wrap gap-1 md:flex-nowrap md:space-x-2 md:space-x-reverse min-w-[140px]",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:()=>ms(s),className:"w-8 h-8 p-0",children:e.jsx(Ps,{className:"h-4 w-4"})}),e.jsx(k,{variant:"outline",size:"sm",onClick:()=>Ye(`/admin/families/${s.id}/edit`),className:"w-8 h-8 p-0",children:e.jsx($s,{className:"h-4 w-4"})}),e.jsx(vs,{href:`/admin/families/${s.id}/summary`,target:"_blank",children:e.jsx(k,{variant:"outline",size:"sm",className:"w-8 h-8 p-0",children:e.jsx(Ls,{className:"h-4 w-4"})})}),e.jsx(k,{size:"sm",variant:"destructive",onClick:()=>{window.confirm("هل أنت متأكد أنك تريد حذف هذه الأسرة؟ سيتم حذف جميع الأفراد والبيانات المرتبطة بها.")&&cs.mutate(s.id)},className:"w-8 h-8 p-0",children:e.jsx(Es,{className:"h-4 w-4"})})]})})]},s.id))})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"outline",size:"sm",disabled:C===1,onClick:()=>Q(1),children:"الأول"}),e.jsx(k,{variant:"outline",size:"sm",disabled:C===1,onClick:()=>Q(C-1),children:"السابق"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["صفحة ",C," من ",ce]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"outline",size:"sm",disabled:C===ce,onClick:()=>Q(C+1),children:"التالي"}),e.jsx(k,{variant:"outline",size:"sm",disabled:C===ce,onClick:()=>Q(ce),children:"الأخير"})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(xe,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:N?"لم يتم العثور على أسر تطابق البحث":"لا توجد أسر مسجلة"})]})})]}),e.jsx(Is,{open:Ue,onOpenChange:ve,children:e.jsxs(Ts,{className:"max-w-4xl max-h-[90vh] w-[95vw] md:w-full overflow-y-auto",children:[e.jsx(Hs,{children:e.jsxs(Fs,{className:"text-center w-full",children:["تفاصيل الأسرة - ",(r==null?void 0:r.husbandName)||""]})}),is?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"text-muted-foreground",children:"جاري تحميل التفاصيل..."})}):De?e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-red-600",children:[e.jsx("div",{children:"حدث خطأ أثناء تحميل بيانات الأسرة."}),e.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:De.message||"يرجى المحاولة مرة أخرى لاحقاً."})]}):r?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-background rounded-lg p-4 border mb-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-2",children:[e.jsxs(w,{className:"bg-blue-100 text-blue-800",children:["رقم الأسرة: ",r.id]}),r.isDisplaced&&e.jsx(w,{variant:"destructive",children:"نازح"}),r.warDamage2023&&e.jsx(w,{variant:"outline",children:"متضرر"}),r.isAbroad&&e.jsx(w,{className:"bg-blue-100 text-blue-800",children:"مغترب"}),r.branch&&e.jsx(w,{className:"bg-green-100 text-green-800",children:Ne(r.branch)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"العنوان الأصلي:"}),e.jsx("span",{className:"mr-2",children:r.originalResidence||"غير محدد"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"مكان السكن الحالي:"}),e.jsx("span",{className:"mr-2",children:r.currentHousing||"غير محدد"})]}),r.isDisplaced&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"موقع النزوح:"}),e.jsx("span",{className:"mr-2",children:r.displacedLocation||"غير محدد"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"أقرب معلم:"}),e.jsx("span",{className:"mr-2",children:r.landmarkNear||"غير محدد"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"ملاحظات الإدارة:"}),e.jsx("span",{className:"mr-2",children:r.adminNotes||"لا يوجد"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 md:p-4 border",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex flex-wrap items-center gap-2",children:["رب الأسرة ",e.jsx(w,{className:"bg-blue-200 text-blue-900",children:r.husbandName})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"رقم الهوية:"})," ",e.jsx("span",{className:"sm:mr-2",children:r.husbandID})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"تاريخ الميلاد:"})," ",e.jsxs("span",{className:"sm:mr-2",children:[r.husbandBirthDate||"غير محدد",r.husbandBirthDate&&e.jsxs(e.Fragment,{children:[" (",e.jsx("span",{className:"text-green-700",children:me(r.husbandBirthDate)}),")"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"المهنة:"})," ",e.jsx("span",{className:"sm:mr-2",children:r.husbandJob||"غير محدد"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"المرض المزمن:"})," ",e.jsx("span",{className:"sm:mr-2",children:r.hasChronicIllness?r.chronicIllnessType||"نعم":"لا"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الإعاقة:"})," ",e.jsx("span",{className:"sm:mr-2",children:r.hasDisability?r.disabilityType||"نعم":"لا"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الجوال:"})," ",e.jsx("span",{className:"sm:mr-2",children:r.primaryPhone||"غير محدد"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الجوال الإضافي:"})," ",e.jsx("span",{className:"sm:mr-2",children:r.secondaryPhone||"غير محدد"})]})]})]}),(r.spouse||r.wifeName)&&e.jsxs("div",{className:"bg-card rounded-lg p-3 md:p-4 border",children:[e.jsx("h4",{className:"font-semibold text-card-foreground mb-3",children:r.userGender==="female"?"الزوج":"الزوجة"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:e.jsx(w,{variant:"secondary",children:r.userGender==="female"?r.spouseAsHusbandName:r.spouseAsWifeName})}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"رقم الهوية:"})," ",e.jsx("span",{className:"sm:mr-2",children:r.userGender==="female"?r.spouseAsHusbandID:r.spouseAsWifeID||"غير محدد"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"تاريخ الميلاد:"})," ",e.jsxs("span",{className:"sm:mr-2",children:[(r.userGender==="female"?r.spouseAsHusbandBirthDate:r.spouseAsWifeBirthDate)||"غير محدد",(r.userGender==="female"?r.spouseAsHusbandBirthDate:r.spouseAsWifeBirthDate)&&e.jsxs(e.Fragment,{children:[" (",e.jsx("span",{className:"text-primary",children:me(r.userGender==="female"?r.spouseAsHusbandBirthDate:r.spouseAsWifeBirthDate)}),")"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"المهنة:"})," ",e.jsx("span",{className:"sm:mr-2",children:r.userGender==="female"?r.spouseAsHusbandJob:r.spouseAsWifeJob||"غير محدد"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"المرض المزمن:"})," ",e.jsx("span",{className:"sm:mr-2",children:(r.userGender==="female"?r.spouseAsHusbandHasChronicIllness:r.spouseAsWifeHasChronicIllness)?(r.userGender==="female"?r.spouseAsHusbandChronicIllnessType:r.spouseAsWifeChronicIllnessType)||"نعم":"لا"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الإعاقة:"})," ",e.jsx("span",{className:"sm:mr-2",children:(r.userGender==="female"?r.spouseAsHusbandHasDisability:r.spouseAsWifeHasDisability)?(r.userGender==="female"?r.spouseAsHusbandDisabilityType:r.spouseAsWifeDisabilityType)||"نعم":"لا"})]}),r.userGender!=="female"&&e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"حامل:"})," ",e.jsx("span",{className:"sm:mr-2",children:(r.userGender==="female"?r.spouseAsHusbandPregnant:r.spouseAsWifePregnant)?e.jsx(w,{variant:"outline",className:"border-warning text-warning",children:"نعم"}):"لا"})]})]})]})]})]}),r.members&&r.members.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground mb-3",children:"أفراد الأسرة"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"block md:hidden space-y-2",children:r.members.map(s=>e.jsxs("div",{className:"border rounded-lg p-3 text-sm",children:[e.jsx("div",{className:"font-medium mb-1",children:s.fullName}),e.jsxs("div",{className:"text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["الجنس: ",Re(s.gender)]}),e.jsxs("div",{children:["القرابة: ",Ge(s.relationship)]}),e.jsxs("div",{children:["تاريخ الميلاد: ",s.birthDate||"غير محدد",s.birthDate&&e.jsxs(e.Fragment,{children:[" (",e.jsx("span",{className:"text-primary",children:me(s.birthDate)}),")"]})]}),e.jsxs("div",{children:["الإعاقة: ",s.isDisabled?s.disabilityType||"نعم":"لا"]}),e.jsxs("div",{children:["المرض المزمن: ",s.hasChronicIllness?s.chronicIllnessType||"نعم":"لا"]})]})]},s.id))}),e.jsxs("table",{className:"hidden md:table w-full text-sm",children:[e.jsx("thead",{className:"bg-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-right",children:"الاسم"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"الجنس"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"القرابة"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"تاريخ الميلاد"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"إعاقة"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"مرض مزمن"})]})}),e.jsx("tbody",{children:r.members.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-3 py-2",children:s.fullName}),e.jsx("td",{className:"px-3 py-2",children:Re(s.gender)}),e.jsx("td",{className:"px-3 py-2",children:Ge(s.relationship)}),e.jsxs("td",{className:"px-3 py-2",children:[s.birthDate||"غير محدد",s.birthDate&&e.jsxs(e.Fragment,{children:[" (",e.jsx("span",{className:"text-primary",children:me(s.birthDate)}),")"]})]}),e.jsx("td",{className:"px-3 py-2",children:s.isDisabled?s.disabilityType||"نعم":"لا"}),e.jsx("td",{className:"px-3 py-2",children:s.hasChronicIllness?s.chronicIllnessType||"نعم":"لا"})]},s.id))})]})]})]}):e.jsx("div",{className:"text-center text-muted-foreground",children:"لا يوجد أفراد مسجلين لهذه الأسرة."}),r.requests&&r.requests.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground mb-3",children:"الطلبات الأخيرة"}),e.jsx("div",{className:"space-y-2",children:r.requests.slice(0,3).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-background rounded border",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium",children:ks(s.type)}),e.jsx("span",{className:"text-muted-foreground text-xs",children:Je(s.createdAt)})]}),e.jsx(w,{variant:s.status==="approved"?"default":s.status==="rejected"?"destructive":"secondary",className:s.status==="approved"?"bg-primary text-primary-foreground":s.status==="rejected"?"":"bg-warning text-warning-foreground",children:Ds(s.status)})]},s.id))})]}):e.jsx("div",{className:"text-center text-muted-foreground",children:"لا توجد طلبات حديثة لهذه الأسرة."})]}):e.jsx("div",{className:"flex flex-col items-center justify-center h-32 text-muted-foreground",children:e.jsx("div",{children:"لا توجد بيانات متاحة لهذه الأسرة."})})]})}),e.jsxs(D,{className:"mb-6 max-w-full",children:[e.jsxs(O,{children:[e.jsxs(we,{className:"flex items-center gap-2 text-green-700",children:[e.jsx(_e,{className:"h-5 w-5"}),"تصدير الأسر إلى Excel"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"حدد الأعمدة التي ترغب في تصديرها، ثم اضغط على زر التصدير."})]}),e.jsxs(A,{className:"max-w-full overflow-hidden",children:[e.jsxs("div",{className:"flex gap-2 mb-2 justify-end flex-wrap",children:[e.jsx(k,{type:"button",variant:"outline",onClick:ds,children:"تحديد الكل"}),e.jsx(k,{type:"button",variant:"outline",onClick:os,children:"إلغاء تحديد الكل"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 mb-4",dir:"rtl",children:[h.filter(s=>s.key.startsWith("husband")).map((s,a)=>e.jsxs("label",{className:`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-all select-none shadow-sm ${y[s.key]??!0?"bg-green-50 border-green-500 text-green-800 font-bold ring-2 ring-green-200":"bg-white border-gray-200 text-gray-700 hover:border-green-300"}`,style:{order:a+1},children:[e.jsx("input",{type:"checkbox",checked:y[s.key]??!0,onChange:()=>pe(s.key),className:"accent-green-600 w-4 h-4"}),e.jsx("span",{className:"text-md",children:s.label})]},s.key)),h.filter(s=>s.key.startsWith("wife")).map((s,a)=>e.jsxs("label",{className:`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-all select-none shadow-sm ${y[s.key]??!0?"bg-green-50 border-green-500 text-green-800 font-bold ring-2 ring-green-200":"bg-white border-gray-200 text-gray-700 hover:border-green-300"}`,style:{order:a+h.filter(c=>c.key.startsWith("husband")).length+1},children:[e.jsx("input",{type:"checkbox",checked:y[s.key]??!0,onChange:()=>pe(s.key),className:"accent-green-600 w-4 h-4"}),e.jsx("span",{className:"text-md",children:s.label})]},s.key)),ge.length>0&&e.jsxs("label",{className:`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-all select-none shadow-sm ${Te?"bg-green-50 border-green-500 text-green-800 font-bold ring-2 ring-green-200":"bg-white border-gray-200 text-gray-700 hover:border-green-300"}`,style:{order:h.filter(s=>s.key.startsWith("husband")).length+h.filter(s=>s.key.startsWith("wife")).length+1},children:[e.jsx("input",{type:"checkbox",checked:Te,onChange:()=>Ce("sons"),className:"accent-green-600 w-4 h-4"}),e.jsx("span",{className:"text-md",children:"الأبناء"})]}),fe.length>0&&e.jsxs("label",{className:`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-all select-none shadow-sm ${He?"bg-green-50 border-green-500 text-green-800 font-bold ring-2 ring-green-200":"bg-white border-gray-200 text-gray-700 hover:border-green-300"}`,style:{order:h.filter(s=>s.key.startsWith("husband")).length+h.filter(s=>s.key.startsWith("wife")).length+2},children:[e.jsx("input",{type:"checkbox",checked:He,onChange:()=>Ce("children"),className:"accent-green-600 w-4 h-4"}),e.jsx("span",{className:"text-md",children:"الأطفال"})]}),h.filter(s=>!s.key.startsWith("son")&&!s.key.startsWith("child")&&!s.key.startsWith("wife")&&!s.key.startsWith("husband")).map((s,a)=>e.jsxs("label",{className:`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-all select-none shadow-sm ${y[s.key]??!0?"bg-green-50 border-green-500 text-green-800 font-bold ring-2 ring-green-200":"bg-white border-gray-200 text-gray-700 hover:border-green-300"}`,style:{order:a+h.filter(c=>c.key.startsWith("husband")).length+h.filter(c=>c.key.startsWith("wife")).length+3},children:[e.jsx("input",{type:"checkbox",checked:y[s.key]??!0,onChange:()=>pe(s.key),className:"accent-green-600 w-4 h-4"}),e.jsx("span",{className:"text-md",children:s.label})]},s.key))]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(k,{onClick:hs,className:"bg-green-600 text-white hover:bg-green-700 flex items-center gap-2 px-8 py-2 text-lg rounded-lg shadow",children:[e.jsx(_e,{className:"h-5 w-5 ml-2"}),"تصدير إلى Excel"]})})]})]})]})})});export{ta as default};
