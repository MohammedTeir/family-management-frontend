import{Q as P,u as Qe,t as Ke,r as d,b as Je,j as e,c as Re,v as le,w as j,B as m,a4 as J,I as o,C,d as D,U as T,e as Ve,f as Ye,x,a5 as _e,A as de,D as g,z as f,X as We,E as pe,H as Ge,G as u,a6 as Xe}from"./index-ZYzdAsGm.js";import{D as me,a as ce,b as oe,c as xe}from"./dialog-S7UO55CL.js";import{a as U}from"./dropdown-menu-C5FzIU9D.js";import{A as R,a as V,b as Y,c as _,d as W,e as G,f as X,g as Z}from"./alert-dialog-BGXVV_jb.js";import{P as $}from"./page-wrapper-DEQQYva8.js";import{T as he}from"./triangle-alert-Dii20Z6F.js";import{T as ue,P as Ze}from"./trash-2-BvJN9095.js";import{S as es}from"./search-DU3OcRQB.js";import"./index-CvI2JamZ.js";import"./baby-B20HtjzY.js";import"./file-text-WTwHpCUH.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=P("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=P("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=P("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=P("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=P("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=P("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ls=pe({username:u().min(3,"اسم المستخدم يجب أن يكون 3 أحرف على الأقل"),password:u().optional(),role:Xe("admin"),phone:u().optional(),isProtected:Ge().optional()}),ds=pe({username:u().regex(/^\d{9}$/,"رقم الهوية يجب أن يكون 9 أرقام").min(1,"رقم الهوية مطلوب"),husbandName:u().min(1,"الاسم مطلوب"),husbandBirthDate:u().optional(),husbandJob:u().optional(),primaryPhone:u().optional(),secondaryPhone:u().optional()});function vs(){const{user:i}=Qe(),{toast:n}=Ke(),[je,v]=d.useState(!1),[c,O]=d.useState(null),[ge,F]=d.useState(!1),[h,I]=d.useState(null),[fe,A]=d.useState(!1),[Ne,S]=d.useState(!1),[be,ee]=d.useState([]),[N,y]=d.useState(1),z=10,[se,ve]=d.useState(""),[k,H]=d.useState("all"),[ye,L]=d.useState(!1),[ms,te]=d.useState([]),{settings:p}=Je();if(d.useEffect(()=>{p.siteTitle&&(document.title=p.siteTitle),p.language&&(document.documentElement.lang=p.language,document.body.dir=p.language==="ar"?"rtl":"ltr")},[p.siteTitle,p.language]),(i==null?void 0:i.role)!=="root"&&(i==null?void 0:i.role)!=="admin")return e.jsx($,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(he,{className:"h-12 w-12 text-accent mx-auto mb-4"}),e.jsx("div",{className:"text-lg text-muted-foreground",children:"غير مصرح لك بالوصول لهذه الصفحة"})]})})});const{data:ae,isLoading:we,isError:Ce}=Re({queryKey:["/api/admin/users"]}),r=le({resolver:de(ls),defaultValues:{username:"",password:"",role:"admin",phone:"",isProtected:!1}}),a=le({resolver:de(ds),defaultValues:{username:"",husbandName:"",husbandBirthDate:"",husbandJob:"",primaryPhone:"",secondaryPhone:""}}),B=j({mutationFn:async s=>(await f("POST","/api/admin/users",s)).data,onSuccess:()=>{g.invalidateQueries({queryKey:["/api/admin/users"]}),v(!1),O(null),r.reset(),n({title:"تم إنشاء المستخدم",description:"تم إنشاء المستخدم الجديد بنجاح"})},onError:s=>{n({title:"خطأ في الإنشاء",description:s.message,variant:"destructive"})}}),Q=j({mutationFn:async s=>{const t={user:{},family:{husbandID:s.username,husbandName:s.husbandName,husbandBirthDate:s.husbandBirthDate,husbandJob:s.husbandJob,primaryPhone:s.primaryPhone,secondaryPhone:s.secondaryPhone},members:[]};return(await f("POST","/api/register-family",t)).data},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/admin/users"]}),F(!1),a.reset(),n({title:"تم إنشاء رب الأسرة",description:"تم إنشاء رب الأسرة الجديد بنجاح"})},onError:s=>{n({title:"خطأ في إنشاء رب الأسرة",description:s.message,variant:"destructive"})}}),K=j({mutationFn:async s=>(await f("PUT",`/api/admin/users/${c.id}`,s)).data,onSuccess:()=>{g.invalidateQueries({queryKey:["/api/admin/users"]}),v(!1),O(null),r.reset(),n({title:"تم تحديث المستخدم",description:"تم تحديث بيانات المستخدم بنجاح"})},onError:s=>{let t=s.message;t.includes("<!DOCTYPE")&&(t="حدث خطأ في الاتصال بالخادم أو انتهت الجلسة. يرجى إعادة تسجيل الدخول أو المحاولة لاحقاً."),n({title:"خطأ في التحديث",description:t,variant:"destructive"})}}),De=j({mutationFn:async({id:s,isHead:t})=>{const l=t?`/api/admin/users/${s}?hard=true`:`/api/admin/users/${s}`;await f("DELETE",l)},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/admin/users"]}),A(!1),I(null),n({title:"تم حذف المستخدم",description:"تم حذف المستخدم من النظام"})},onError:s=>{var l;let t=s.message;if(s.response&&s.response.status===409&&((l=s.response.data)==null?void 0:l.code)==="USER_REFERENCED_IN_FAMILY"){ee(s.response.data.families||[]),S(!0);return}(t.includes("<!DOCTYPE")||t==="Internal server error")&&(t="حدث خطأ غير متوقع أثناء حذف المستخدم. يرجى المحاولة لاحقاً أو التواصل مع الدعم."),n({title:"خطأ في الحذف",description:t,variant:"destructive"})}}),E=j({mutationFn:async()=>await f("DELETE","/api/admin/heads"),onSuccess:()=>{g.invalidateQueries({queryKey:["/api/admin/users"]}),L(!1),te([]),n({title:"تم حذف جميع رؤساء الأسر",description:"تم حذف جميع رؤساء الأسر وجميع العائلات المرتبطة بهم بنجاح."})},onError:s=>{let t=s.message;(t.includes("<!DOCTYPE")||t==="Internal server error")&&(t="حدث خطأ غير متوقع أثناء حذف رؤساء الأسر. يرجى المحاولة لاحقاً أو التواصل مع الدعم."),n({title:"خطأ في حذف رؤساء الأسر",description:t,variant:"destructive"})}}),Pe=j({mutationFn:async({id:s,isHead:t})=>{const l=t?`/api/admin/users/${s}?cascade=true&hard=true`:`/api/admin/users/${s}?cascade=true`;await f("DELETE",l)},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/admin/users"]}),S(!1),A(!1),I(null),ee([]),n({title:"تم حذف المستخدم والعائلات المرتبطة",description:"تم حذف المستخدم وجميع العائلات والأفراد المرتبطين به بنجاح."})},onError:s=>{let t=s.message;(t.includes("<!DOCTYPE")||t==="Internal server error")&&(t="حدث خطأ غير متوقع أثناء الحذف المتسلسل. يرجى المحاولة لاحذاً أو التواصل مع الدعم."),n({title:"خطأ في الحذف المتسلسل",description:t,variant:"destructive"})}}),Se=j({mutationFn:async s=>{await f("POST",`/api/admin/users/${s}/restore`)},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/admin/users"]}),n({title:"تمت الاستعادة",description:"تمت استعادة المستخدم بنجاح."})},onError:s=>{let t=s.message;(t.includes("<!DOCTYPE")||t==="Internal server error")&&(t="حدث خطأ أثناء استعادة المستخدم. يرجى المحاولة لاحقاً."),n({title:"خطأ في الاستعادة",description:t,variant:"destructive"})}}),ke=j({mutationFn:async s=>{await f("POST",`/api/admin/users/${s}/reset-lockout`)},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/admin/users"]}),n({title:"تم إلغاء الحظر",description:"تم إلغاء حظر المستخدم بنجاح."})},onError:s=>{let t=s.message;n({title:"خطأ في إلغاء الحظر",description:t,variant:"destructive"})}}),b=Array.isArray(ae)?ae:[],Ee=b.length,M=s=>/^\d+$/.test(s),w=b.filter(s=>s.role==="head"||s.role==="admin"&&M(s.username)),re=b.filter(s=>s.role==="admin"&&!M(s.username)),Te=b.filter(s=>s.isProtected),q=b.filter(s=>{var ie;const t=se.toLowerCase(),l=s.username.toLowerCase().includes(t)||((ie=s.phone)==null?void 0:ie.toLowerCase().includes(t)),Be=(()=>{switch(k){case"admins":return s.role==="admin"&&!M(s.username);case"heads":return s.role==="head"||s.role==="admin"&&M(s.username);case"root":return s.role==="root";default:return!0}})();return l&&Be}),ne=Math.ceil(q.length/z),Oe=q.slice((N-1)*z,N*z),Fe=s=>{if(!c&&!s.password){r.setError("password",{type:"manual",message:"كلمة المرور مطلوبة للمشرفين"});return}if(s.password){const t=We(s.password,p);if(t.length>0){t.forEach(l=>r.setError("password",{type:"manual",message:l}));return}}if(c){const t={...s};s.password||delete t.password,K.mutate(t)}else B.mutate(s)},Ae=s=>{Q.mutate(s)},He=s=>{O(s),r.reset({username:s.username,password:"",role:s.role,phone:s.phone||"",isProtected:!!s.isProtected}),v(!0)},Le=()=>{O(null),r.reset({username:"",password:"",role:"admin",phone:"",isProtected:!1}),v(!0)},Me=()=>{a.reset({username:"",husbandName:"",husbandBirthDate:"",husbandJob:"",primaryPhone:"",secondaryPhone:""}),F(!0)},qe=()=>{te(w),L(!0)},Ue=s=>{const t=s.role==="head"||s.role==="admin"&&/^\d+$/.test(s.username);I({...s,isHead:t}),A(!0)},$e=s=>i?i.role==="root"?s.id!==i.id:i.role==="admin"?s.role==="root"||s.role==="admin"&&s.isProtected?!1:s.role==="head"||s.role==="admin"&&!s.isProtected:!1:!1,Ie=s=>{switch(s){case"root":return"مشرف رئيسي";case"admin":return"مشرف";case"head":return"رب أسرة";default:return s}},ze=s=>{switch(s){case"root":return"destructive";case"admin":return"default";case"head":return"secondary";default:return"outline"}};return we?e.jsx($,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg text-muted-foreground",children:"جاري تحميل البيانات..."})})}):Ce?e.jsx($,{children:e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg text-red-600",children:"حدث خطأ أثناء تحميل المستخدمين"})})})}):e.jsx($,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground mb-2",children:"إدارة المستخدمين"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"إدارة المستخدمين وصلاحياتهم"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(m,{onClick:Le,className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{className:"sm:inline",children:"إضافة مشرف"})]}),e.jsxs(m,{onClick:Me,variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(is,{className:"h-4 w-4"}),e.jsx("span",{className:"sm:inline",children:"إضافة رب أسرة"})]}),w.length>0&&e.jsxs(m,{onClick:qe,variant:"destructive",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{className:"sm:inline",children:"حذف جميع رؤساء الأسر"})]})]})]}),e.jsx("div",{className:"flex items-center justify-end gap-2 mb-8",children:e.jsxs("div",{className:"relative w-full sm:w-80",children:[e.jsx(es,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(o,{placeholder:"البحث باسم المستخدم أو رقم الجوال...",value:se,onChange:s=>ve(s.target.value),className:"pr-10"})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8",children:[e.jsx(C,{children:e.jsx(D,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 sm:p-3 bg-primary/10 rounded-lg flex-shrink-0",children:e.jsx(T,{className:"h-5 w-5 sm:h-6 sm:w-6 text-primary"})}),e.jsxs("div",{className:"mr-3 sm:mr-4",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-foreground",children:Ee})]})]})})}),e.jsx(C,{children:e.jsx(D,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 sm:p-3 bg-purple-500/10 rounded-lg flex-shrink-0",children:e.jsx(J,{className:"h-5 w-5 sm:h-6 sm:w-6 text-purple-600"})}),e.jsxs("div",{className:"mr-3 sm:mr-4",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"المشرفين"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-foreground",children:re.length})]})]})})}),e.jsx(C,{children:e.jsx(D,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 sm:p-3 bg-secondary/10 rounded-lg flex-shrink-0",children:e.jsx(T,{className:"h-5 w-5 sm:h-6 sm:w-6 text-secondary"})}),e.jsxs("div",{className:"mr-3 sm:mr-4",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"رؤساء الأسر"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-foreground",children:w.length})]})]})})}),e.jsx(C,{children:e.jsx(D,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 sm:p-3 bg-accent/10 rounded-lg flex-shrink-0",children:e.jsx(rs,{className:"h-5 w-5 sm:h-6 sm:w-6 text-accent"})}),e.jsxs("div",{className:"mr-3 sm:mr-4",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"محميين"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-foreground",children:Te.length})]})]})})})]}),e.jsx(C,{className:"mb-8 border-warning/20 bg-warning/10",children:e.jsx(D,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(he,{className:"h-4 w-4 sm:h-5 sm:w-5 text-warning mt-1 ml-2 sm:ml-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm sm:text-base font-medium text-warning mb-1",children:"ملاحظة مهمة"}),e.jsx("p",{className:"text-xs sm:text-sm text-foreground",children:"لا يمكن تعديل أو حذف المستخدمين المحميين أو المشرفين الرئيسيين. كما لا يمكنك تعديل حسابك الشخصي من هذه الصفحة."})]})]})})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-2 border-b border-border",children:[e.jsxs("button",{onClick:()=>{H("all"),y(1)},className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${k==="all"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[e.jsx(T,{className:"inline w-4 h-4 mr-2"}),"الكل (",b.length,")"]}),e.jsxs("button",{onClick:()=>{H("admins"),y(1)},className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${k==="admins"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[e.jsx(J,{className:"inline w-4 h-4 mr-2"}),"المشرفين (",re.length,")"]}),e.jsxs("button",{onClick:()=>{H("heads"),y(1)},className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${k==="heads"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[e.jsx(T,{className:"inline w-4 h-4 mr-2"}),"رؤساء الأسر (",w.length,")"]}),e.jsxs("button",{onClick:()=>{H("root"),y(1)},className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${k==="root"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[e.jsx(ss,{className:"inline w-4 h-4 mr-2"}),"المشرفين الرئيسيين (",b.filter(s=>s.role==="root").length,")"]})]})}),e.jsxs(C,{children:[e.jsx(Ve,{children:e.jsxs(Ye,{className:"text-lg sm:text-xl",children:["قائمة المستخدمين (",q.length,")"]})}),e.jsx(D,{className:"p-4 sm:p-6",children:q.length>0?e.jsxs("div",{className:"overflow-x-auto -mx-4 sm:mx-0 rounded-lg border border-border bg-card shadow mt-6",children:[e.jsxs("table",{className:"w-full min-w-[700px] sm:min-w-0 divide-y divide-border",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 sm:px-4 py-3 text-right text-xs sm:text-sm font-medium text-muted-foreground",children:"اسم المستخدم"}),e.jsx("th",{className:"px-2 sm:px-4 py-3 text-right text-xs sm:text-sm font-medium text-muted-foreground",children:"الدور"}),e.jsx("th",{className:"px-2 sm:px-4 py-3 text-right text-xs sm:text-sm font-medium text-muted-foreground",children:"رقم الجوال"}),e.jsx("th",{className:"px-2 sm:px-4 py-3 text-right text-xs sm:text-sm font-medium text-muted-foreground",children:"الحالة"}),e.jsx("th",{className:"px-2 sm:px-4 py-3 text-right text-xs sm:text-sm font-medium text-muted-foreground",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"bg-card divide-y divide-border",children:Oe.map(s=>{const t=!!s.deletedAt,l=s.lockoutUntil&&new Date(s.lockoutUntil)>new Date;return e.jsxs("tr",{className:t?"bg-muted text-muted-foreground":"hover:bg-muted",children:[e.jsx("td",{className:"px-2 sm:px-4 py-3 text-sm",children:s.username}),e.jsx("td",{className:"px-2 sm:px-4 py-3",children:e.jsx(U,{variant:ze(s.role),className:"text-xs",children:Ie(s.role)})}),e.jsx("td",{className:"px-2 sm:px-4 py-3 text-sm",children:s.phone||"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-3",children:t?e.jsx(U,{variant:"destructive",className:"text-xs",children:"محذوف"}):l?e.jsxs(U,{variant:"destructive",className:"text-xs",children:[e.jsx(as,{className:"inline w-3 h-3 mr-1"}),"محظور مؤقتاً"]}):e.jsx(U,{variant:"outline",className:"text-xs",children:"نشط"})}),e.jsxs("td",{className:"px-2 sm:px-4 py-3 flex flex-wrap gap-1 sm:gap-2",children:[!t&&$e(s)&&e.jsxs(e.Fragment,{children:[e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>He(s),title:"تعديل",className:"h-8 w-8 p-0",children:e.jsx(Ze,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>Ue(s),title:"حذف",className:"h-8 w-8 p-0",children:e.jsx(ue,{className:"w-3 h-3 sm:w-4 sm:h-4 text-destructive"})}),l&&e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>ke.mutate(s.id),title:"إلغاء الحظر",className:"h-8 w-8 p-0",children:e.jsx(ts,{className:"w-3 h-3 sm:w-4 sm:h-4 text-green-600"})})]}),t&&e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>Se.mutate(s.id),title:"استعادة المستخدم",className:"h-8 w-8 p-0",children:e.jsx(ns,{className:"w-3 h-3 sm:w-4 sm:h-4 text-green-600"})})]})]},s.id)})})]}),e.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-2 mt-4 px-4 sm:px-0",children:[e.jsx(m,{variant:"outline",size:"sm",disabled:N===1,onClick:()=>y(N-1),className:"text-xs sm:text-sm",children:"السابق"}),e.jsxs("span",{className:"text-sm sm:text-base text-foreground px-2",children:["صفحة ",N," من ",ne]}),e.jsx(m,{variant:"outline",size:"sm",disabled:N===ne,onClick:()=>y(N+1),className:"text-xs sm:text-sm",children:"التالي"})]})]}):e.jsxs("div",{className:"text-center py-8 px-4",children:[e.jsx(T,{className:"h-10 w-10 sm:h-12 sm:w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"لا توجد مستخدمين"})]})})]}),e.jsx(me,{open:je,onOpenChange:v,children:e.jsxs(ce,{className:"max-w-[95vw] w-full sm:max-w-md lg:max-w-lg p-4 sm:p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsx(xe,{children:c?"تعديل المشرف":"إضافة مشرف جديد"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"الحقول المتاحة: اسم المستخدم، كلمة المرور، رقم الجوال، حالة الحماية"})]}),e.jsxs("form",{onSubmit:r.handleSubmit(Fe),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"username",className:"text-sm sm:text-base",children:"اسم المستخدم *"}),e.jsx(o,{id:"username",placeholder:"أدخل اسم المستخدم (مثال: admin01)",...r.register("username",{required:!0}),className:"mt-1"}),r.formState.errors.username&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:r.formState.errors.username.message})]}),e.jsxs("div",{children:[e.jsxs(x,{htmlFor:"password",className:"text-sm sm:text-base",children:["كلمة المرور ",c?"(اتركها فارغة للاحتفاظ بالحالية)":"*"]}),e.jsx(o,{id:"password",type:"password",placeholder:"أدخل كلمة المرور",...r.register("password"),className:"mt-1"}),r.formState.errors.password&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:r.formState.errors.password.message})]}),c&&c.role==="head"&&r.watch("role")==="admin"&&e.jsxs("div",{className:"mb-4 p-3 bg-primary/10 border border-primary/20 rounded text-foreground text-xs sm:text-sm",children:[e.jsx("strong",{children:"تنبيه:"})," عند ترقية رب الأسرة إلى مشرف، سيبقى بإمكانه تسجيل الدخول كرب أسرة باستخدام رقم الهوية، وكـ مشرف باستخدام اسم المستخدم. لن يتم تغيير اسم المستخدم الحالي."]}),c&&c.role==="admin"&&/^\d+$/.test(c.username)&&e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"inline-block bg-secondary/10 text-secondary px-3 py-1 rounded text-xs font-bold",children:"مشرف + رب أسرة"})}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"phone",className:"text-sm sm:text-base",children:"رقم الجوال"}),e.jsx(o,{id:"phone",placeholder:"أدخل رقم الجوال (مثال: 0592524815)",...r.register("phone"),className:"mt-1"})]}),(i==null?void 0:i.role)==="root"&&c&&c.id!==i.id&&e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{htmlFor:"isProtected",className:"text-sm",children:"مستخدم محمي"}),e.jsx("input",{type:"checkbox",id:"isProtected",...r.register("isProtected"),checked:r.watch("isProtected"),onChange:s=>r.setValue("isProtected",s.target.checked),className:"h-4 w-4"})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"تفعيل هذا الخيار يجعل المستخدم محمي من الحذف أو التعديل من قبل غير المشرف الرئيسي."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 sm:space-x-2 sm:space-x-reverse pt-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>v(!1),className:"w-full sm:w-auto order-2 sm:order-1",children:"إلغاء"}),e.jsx(m,{type:"submit",disabled:B.isPending||K.isPending,className:"w-full sm:w-auto order-1 sm:order-2",children:B.isPending||K.isPending?"جاري الحفظ...":"حفظ"})]})]})]})}),e.jsx(R,{open:fe,onOpenChange:A,children:e.jsxs(V,{children:[e.jsxs(Y,{children:[e.jsx(_,{children:"تأكيد الحذف"}),e.jsxs(W,{children:['هل أنت متأكد من حذف المستخدم "',h==null?void 0:h.username,'"؟ هذا الإجراء لا يمكن التراجع عنه.']})]}),e.jsxs(G,{className:"flex-row-reverse",children:[e.jsx(X,{children:"إلغاء"}),e.jsx(Z,{onClick:()=>h&&De.mutate({id:h.id,isHead:h.isHead}),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"حذف"})]})]})}),e.jsx(R,{open:Ne,onOpenChange:S,children:e.jsxs(V,{children:[e.jsxs(Y,{children:[e.jsx(_,{children:"تأكيد الحذف المتسلسل"}),e.jsxs(W,{children:["لا يمكن حذف هذا المستخدم لأنه مرتبط بعائلات. إذا تابعت، سيتم حذف جميع العائلات والأفراد المرتبطين به بشكل نهائي.",e.jsx("ul",{className:"mt-4 text-right text-sm text-red-700",children:be.map(s=>e.jsxs("li",{children:["• ",s.husbandName," (رقم الهوية: ",s.husbandID,")"]},s.id))}),e.jsx("div",{className:"mt-4 font-bold text-red-800",children:"هل تريد بالتأكيد حذف المستخدم وجميع العائلات المرتبطة به؟ هذا الإجراء لا يمكن التراجع عنه."})]})]}),e.jsxs(G,{className:"flex-row-reverse",children:[e.jsx(X,{onClick:()=>S(!1),children:"إلغاء"}),e.jsx(Z,{onClick:()=>{S(!1),h&&Pe.mutate({id:h.id,isHead:h.isHead})},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"حذف المستخدم والعائلات المرتبطة"})]})]})}),e.jsx(me,{open:ge,onOpenChange:F,children:e.jsxs(ce,{className:"max-w-[95vw] w-full sm:max-w-md lg:max-w-lg p-4 sm:p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsx(xe,{children:"إضافة رب أسرة جديد"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"أدخل البيانات الأساسية لرب الأسرة الجديد"})]}),e.jsxs("form",{onSubmit:a.handleSubmit(Ae),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"head-username",className:"text-sm sm:text-base",children:"رقم الهوية *"}),e.jsx(o,{id:"head-username",placeholder:"أدخل رقم الهوية (9 أرقام)",...a.register("username",{required:!0}),className:"mt-1"}),a.formState.errors.username&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:a.formState.errors.username.message})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"head-name",className:"text-sm sm:text-base",children:"الاسم الرباعي *"}),e.jsx(o,{id:"head-name",placeholder:"أدخل الاسم الرباعي",...a.register("husbandName",{required:!0}),className:"mt-1"}),a.formState.errors.husbandName&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:a.formState.errors.husbandName.message})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"head-birthdate",className:"text-sm sm:text-base",children:"تاريخ الميلاد"}),e.jsx(o,{id:"head-birthdate",type:"date",...a.register("husbandBirthDate"),className:"mt-1"}),a.formState.errors.husbandBirthDate&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:a.formState.errors.husbandBirthDate.message})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"head-job",className:"text-sm sm:text-base",children:"المهنة"}),e.jsx(o,{id:"head-job",placeholder:"أدخل المهنة",...a.register("husbandJob"),className:"mt-1"}),a.formState.errors.husbandJob&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:a.formState.errors.husbandJob.message})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"head-primary-phone",className:"text-sm sm:text-base",children:"رقم الجوال الأساسي"}),e.jsx(o,{id:"head-primary-phone",placeholder:"أدخل رقم الجوال (مثال: 0592524815)",...a.register("primaryPhone"),className:"mt-1"}),a.formState.errors.primaryPhone&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:a.formState.errors.primaryPhone.message})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"head-secondary-phone",className:"text-sm sm:text-base",children:"رقم الجوال البديل"}),e.jsx(o,{id:"head-secondary-phone",placeholder:"أدخل رقم الجوال البديل",...a.register("secondaryPhone"),className:"mt-1"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 sm:space-x-2 sm:space-x-reverse pt-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>F(!1),className:"w-full sm:w-auto order-2 sm:order-1",children:"إلغاء"}),e.jsx(m,{type:"submit",disabled:Q.isPending,className:"w-full sm:w-auto order-1 sm:order-2",children:Q.isPending?"جاري الحفظ...":"حفظ"})]})]})]})}),e.jsx(R,{open:ye,onOpenChange:L,children:e.jsxs(V,{className:"max-w-lg",children:[e.jsxs(Y,{children:[e.jsx(_,{children:"تأكيد حذف جميع رؤساء الأسر"}),e.jsx(W,{children:E.isPending?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-3 p-4 bg-muted rounded-lg",children:[e.jsx(_e,{className:"h-6 w-6 animate-spin text-destructive"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-destructive",children:"جاري حذف جميع رؤساء الأسر..."}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["يتم حذف ",w.length," رب أسرة وجميع البيانات المرتبطة بهم"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"⚠️ هذه العملية قد تستغرق عدة ثوانٍ، يرجى الانتظار"})]})]})}):e.jsxs(e.Fragment,{children:["هذا الإجراء سيحذف جميع رؤساء الأسر (",w.length," مستخدم) وجميع العائلات والأفراد المرتبطين بهم بشكل نهائي ودائم من قاعدة البيانات.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{className:"text-destructive",children:"⚠️ حذف دائم - لا يمكن التراجع عنه أو استعادة البيانات. هل أنت متأكد من المتابعة؟"})]})})]}),e.jsxs(G,{className:"flex-row-reverse",children:[e.jsx(X,{onClick:()=>L(!1),disabled:E.isPending,children:E.isPending?"إغلاق":"إلغاء"}),!E.isPending&&e.jsx(Z,{onClick:()=>E.mutate(),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"حذف جميع رؤساء الأسر"})]})]})})]})})}export{vs as default};
