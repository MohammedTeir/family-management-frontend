import{j as e,Z as h,C as H,d as M,e as ie,r as m,a as Zs,t as Xs,b as Ks,c as hs,w as ea,O as os,g as $e,i as ee,U as ve,f as us,I as se,S as z,m as _,n as V,p as U,q as o,P as xs,B as C,L as sa,y as De,M as ms,N as ps,s as aa,o as ra,k as ta,h as la}from"./index-ZYzdAsGm.js";import{a as T}from"./dropdown-menu-C5FzIU9D.js";import{D as gs,a as fs,b as bs,c as ys}from"./dialog-S7UO55CL.js";import{E as na}from"./exceljs.min-C7FvAONt.js";import{P as js}from"./page-wrapper-DEQQYva8.js";import{M as ia}from"./map-pin-BVNRh1gA.js";import{S as ca}from"./search-DU3OcRQB.js";import{P as da}from"./phone-BLbwEGI_.js";import{E as ha}from"./eye-BrxwuaB8.js";import{P as oa,T as ua}from"./trash-2-BvJN9095.js";import{F as xa}from"./file-text-WTwHpCUH.js";import{F as Fe}from"./file-spreadsheet-Z1fdQF6G.js";import"./index-CvI2JamZ.js";import"./baby-B20HtjzY.js";function ma(){return e.jsxs("div",{className:"space-y-6 max-w-full min-w-0",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(h,{className:"h-8 w-48 mb-2"}),e.jsx(h,{className:"h-4 w-80"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:Array.from({length:4}).map((ce,k)=>e.jsx(H,{children:e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{className:"h-12 w-12 rounded-lg"}),e.jsxs("div",{className:"mr-4 space-y-2",children:[e.jsx(h,{className:"h-3 w-20"}),e.jsx(h,{className:"h-6 w-12"})]})]})})},k))}),e.jsxs(H,{className:"mb-8",children:[e.jsx(ie,{children:e.jsx(h,{className:"h-5 w-32"})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"relative w-full max-w-md",children:e.jsx(h,{className:"h-10 w-full rounded-md"})})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Array.from({length:4}).map((ce,k)=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(h,{className:"h-4 w-16 mb-1"}),e.jsx(h,{className:"h-10 w-full rounded-md"})]},k))})]})})]}),e.jsxs(H,{children:[e.jsx(ie,{children:e.jsx(h,{className:"h-5 w-40"})}),e.jsx(M,{children:e.jsxs("div",{className:"overflow-x-auto max-w-full",children:[e.jsxs("div",{className:"w-full min-w-full",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-4 py-3 border-b",children:[e.jsx(h,{className:"h-4 w-20"}),e.jsx(h,{className:"h-4 w-24"}),e.jsx(h,{className:"h-4 w-20"}),e.jsx(h,{className:"h-4 w-16"}),e.jsx(h,{className:"h-4 w-20"}),e.jsx(h,{className:"h-4 w-16"})]}),Array.from({length:10}).map((ce,k)=>e.jsxs("div",{className:"grid grid-cols-6 gap-4 py-4 border-b hover:bg-muted",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"h-4 w-32"}),e.jsx(h,{className:"h-3 w-24"})]}),e.jsx(h,{className:"h-4 w-24"}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx(h,{className:"h-4 w-8 mx-auto"}),e.jsx(h,{className:"h-3 w-20 mx-auto"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx(h,{className:"h-5 w-12 rounded-full"}),e.jsx(h,{className:"h-5 w-12 rounded-full"})]}),e.jsx(h,{className:"h-4 w-20"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(h,{className:"h-8 w-8 rounded"}),e.jsx(h,{className:"h-8 w-8 rounded"}),e.jsx(h,{className:"h-8 w-8 rounded"}),e.jsx(h,{className:"h-8 w-8 rounded"})]})]},k))]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{className:"h-8 w-16"}),e.jsx(h,{className:"h-8 w-16"})]}),e.jsx(h,{className:"h-4 w-32"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{className:"h-8 w-16"}),e.jsx(h,{className:"h-8 w-16"})]})]})]})})]}),e.jsxs(H,{className:"mb-6 max-w-full",children:[e.jsxs(ie,{children:[e.jsx(h,{className:"h-5 w-48"}),e.jsx(h,{className:"h-4 w-80 mt-2"})]}),e.jsxs(M,{className:"max-w-full overflow-hidden",children:[e.jsxs("div",{className:"flex gap-2 mb-2 justify-end flex-wrap",children:[e.jsx(h,{className:"h-9 w-20"}),e.jsx(h,{className:"h-9 w-24"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 mb-4",children:Array.from({length:12}).map((ce,k)=>e.jsx(h,{className:"h-12 w-full rounded-lg"},k))}),e.jsx("div",{className:"flex justify-end",children:e.jsx(h,{className:"h-12 w-40 rounded-lg"})})]})]})]})}const Sa=m.memo(function(){const[k,Ns]=m.useState(""),[O,ws]=m.useState(null),[ks,Be]=m.useState(!1),[S,de]=m.useState(1),Ie=10,[,vs]=Zs(),{toast:he}=Xs(),[oe,Ds]=m.useState("all"),[ue,Is]=m.useState("all"),[xe,As]=m.useState("all"),[me,Cs]=m.useState("all"),[pe,Ts]=m.useState("all"),[ge,Ws]=m.useState("all"),[Y,pa]=m.useState("all"),[E,Hs]=m.useState("all"),[Ae,ga]=m.useState(""),[Ce,fa]=m.useState(""),[fe,Ms]=m.useState(""),[be,Ss]=m.useState(""),[$s,Pe]=m.useState(!1),[ae,Te]=m.useState(""),[D,Fs]=m.useState(""),[I,Bs]=m.useState(""),{settings:R}=Ks();m.useEffect(()=>{R.siteTitle&&(document.title=R.siteTitle),R.language&&(document.documentElement.lang=R.language,document.body.dir=R.language==="ar"?"rtl":"ltr")},[R.siteTitle,R.language]);const q=s=>{if(!s)return 0;const a=new Date,p=new Date(s);let N=a.getFullYear()-p.getFullYear();const v=a.getMonth()-p.getMonth();return(v<0||v===0&&a.getDate()<p.getDate())&&N--,N},Ps=s=>s.isAbroad?s.abroadLocation||"مغترب بالخارج":s.isDisplaced?"نازح":"مقيم",{data:y,isLoading:Es}=hs({queryKey:["/api/admin/families"]}),{data:l,isLoading:Ls,error:Ee}=hs({queryKey:["/api/admin/families",O==null?void 0:O.id],enabled:!!(O!=null&&O.id),queryFn:async()=>{const a=(await os.get(`/api/admin/families/${O.id}`)).data,p=a.userGender||"male";return a.spouse?p==="female"?(a.spouseAsHusbandName=a.spouse.husbandName||a.spouse.wifeName,a.spouseAsHusbandID=a.spouse.husbandID||a.spouse.wifeID,a.spouseAsHusbandBirthDate=a.spouse.husbandBirthDate||a.spouse.wifeBirthDate,a.spouseAsHusbandJob=a.spouse.husbandJob||a.spouse.wifeJob,a.spouseAsHusbandPregnant=a.spouse.husbandPregnant||a.spouse.wifePregnant,a.spouseAsHusbandHasChronicIllness=a.spouse.husbandHasChronicIllness||a.spouse.wifeHasChronicIllness,a.spouseAsHusbandChronicIllnessType=a.spouse.husbandChronicIllnessType||a.spouse.wifeChronicIllnessType,a.spouseAsHusbandHasDisability=a.spouse.husbandHasDisability||a.spouse.wifeHasDisability,a.spouseAsHusbandDisabilityType=a.spouse.husbandDisabilityType||a.spouse.wifeDisabilityType):(a.spouseAsWifeName=a.spouse.wifeName,a.spouseAsWifeID=a.spouse.wifeID,a.spouseAsWifeBirthDate=a.spouse.wifeBirthDate,a.spouseAsWifeJob=a.spouse.wifeJob,a.spouseAsWifePregnant=a.spouse.wifePregnant,a.spouseAsWifeHasChronicIllness=a.spouse.wifeHasChronicIllness,a.spouseAsWifeChronicIllnessType=a.spouse.wifeChronicIllnessType,a.spouseAsWifeHasDisability=a.spouse.wifeHasDisability,a.spouseAsWifeDisabilityType=a.spouse.wifeDisabilityType):a.wifeName&&(p==="female"?(a.spouseAsHusbandName=a.wifeName,a.spouseAsHusbandID=a.wifeID,a.spouseAsHusbandBirthDate=a.wifeBirthDate,a.spouseAsHusbandJob=a.wifeJob,a.spouseAsHusbandPregnant=a.wifePregnant,a.spouseAsHusbandHasChronicIllness=a.wifeHasChronicIllness,a.spouseAsHusbandChronicIllnessType=a.wifeChronicIllnessType,a.spouseAsHusbandHasDisability=a.wifeHasDisability,a.spouseAsHusbandDisabilityType=a.wifeDisabilityType):(a.spouseAsWifeName=a.wifeName,a.spouseAsWifeID=a.wifeID,a.spouseAsWifeBirthDate=a.wifeBirthDate,a.spouseAsWifeJob=a.wifeJob,a.spouseAsWifePregnant=a.wifePregnant,a.spouseAsWifeHasChronicIllness=a.wifeHasChronicIllness,a.spouseAsWifeChronicIllnessType=a.wifeChronicIllnessType,a.spouseAsWifeHasDisability=a.wifeHasDisability,a.spouseAsWifeDisabilityType=a.wifeDisabilityType)),a}}),Js=ea({mutationFn:async s=>(await os.delete(`/api/admin/families/${s}`),s),onSuccess:()=>{he({title:"تم حذف الأسرة",description:"تم حذف الأسرة بنجاح"}),window.location.reload()},onError:s=>{he({title:"خطأ في الحذف",description:s.message,variant:"destructive"})}});m.useMemo(()=>Array.from(new Set((y||[]).map(s=>s.branch).filter(Boolean))),[y]);const $=m.useMemo(()=>Array.isArray(y)?y.filter(s=>{var A;const a=k.toLowerCase(),p=s.husbandName.toLowerCase(),N=$e(s.branch),v=(N==null?void 0:N.toLowerCase())||"",b=p.includes(a)||s.husbandID.includes(k)||v.includes(a),G=oe==="all"||s.branch===oe,L=ue==="all"||(ue==="yes"?s.isDisplaced:!s.isDisplaced),J=xe==="all"||(xe==="yes"?s.warDamage2023:!s.warDamage2023),Q=me==="all"||(me==="yes"?s.isAbroad:!s.isAbroad),Z=pe==="all"||s.socialStatus===pe,F=E==="all"||E==="small"&&s.totalMembers<=3||E==="medium"&&s.totalMembers>3&&s.totalMembers<=6||E==="large"&&s.totalMembers>6||E==="custom"&&(fe===""||s.totalMembers!==null&&s.totalMembers!==void 0&&s.totalMembers>=(parseInt(fe)||0))&&(be===""||s.totalMembers!==null&&s.totalMembers!==void 0&&s.totalMembers<=(parseInt(be)||1/0)),B=ge==="all"||(ge==="yes"?s.wifePregnant:!s.wifePregnant),u=((A=s.members)==null?void 0:A.filter(g=>{if(!g.birthDate)return!1;const i=new Date,c=new Date(g.birthDate);let d=i.getFullYear()-c.getFullYear();const P=i.getMonth()-c.getMonth();return(P<0||P===0&&i.getDate()<c.getDate())&&d--,d<2}))||[],we=Y==="all"||(Y==="yes"?u.length>0:u.length===0)||Y==="many"&&u.length>=3||Y==="few"&&u.length>0&&u.length<3||Y==="custom"&&(Ae===""||u.length>=parseInt(Ae))&&(Ce===""||u.length<=parseInt(Ce)),le=D===""&&I===""||Array.isArray(s.members)&&s.members.some(g=>{if(!g.birthDate)return!1;const i=new Date,c=new Date(g.birthDate);if(c>i)return!1;let d=i.getFullYear()-c.getFullYear();const P=i.getMonth()-c.getMonth();(P<0||P===0&&i.getDate()<c.getDate())&&d--;const X=parseInt(D)||0,K=parseInt(I)||1/0;return D!==""&&I===""?d>=X:D===""&&I!==""?d<=K:D!==""&&I!==""?d>=X&&d<=K:!0}),r=D===""&&I===""||(Array.isArray(s.orphans)?s.orphans.some(g=>{if(!g.orphanBirthDate)return!1;const i=new Date,c=new Date(g.orphanBirthDate);if(c>i)return!1;let d=i.getFullYear()-c.getFullYear();const P=i.getMonth()-c.getMonth();(P<0||P===0&&i.getDate()<c.getDate())&&d--;const X=parseInt(D)||0,K=parseInt(I)||1/0;return D!==""&&I===""?d>=X:D===""&&I!==""?d<=K:D!==""&&I!==""?d>=X&&d<=K:!0}):!1);return b&&G&&L&&J&&Q&&Z&&F&&B&&we&&(le||r)}):[],[y,k,oe,ue,xe,me,pe,ge,Y,E,fe,be,Ae,Ce,D,I]),{maxSons:ye,maxChildren:je,maxWives:Le,maxOrphans:Je}=m.useMemo(()=>{const s=Array.isArray($)?$:[];if(s.length===0)return{maxSons:0,maxChildren:0,maxWives:0,maxOrphans:0};let a=0,p=0,N=0,v=0;return s.forEach(b=>{const G=Array.isArray(b.members)?b.members:[],L=Array.isArray(b.orphans)?b.orphans:[],J=[...G];if(Array.isArray(L)){const B=L.map(u=>({...u,fullName:u.orphanName||u.fullName,memberID:u.orphanID||u.memberID,birthDate:u.orphanBirthDate||u.birthDate,isDisabled:u.isDisabled||u.orphanIsDisabled,disabilityType:u.disabilityType||u.orphanDisabilityType,hasChronicIllness:u.hasChronicIllness||u.orphanHasChronicIllness,chronicIllnessType:u.chronicIllnessType||u.orphanChronicIllnessType,hasWarInjury:u.hasWarInjury||u.orphanHasWarInjury,warInjuryType:u.warInjuryType||u.orphanWarInjuryType}));J.push(...B)}const Q=J.filter(B=>!ee(B.birthDate)).length,Z=J.filter(B=>ee(B.birthDate)).length,F=b.wife||b.wifeName?1:0;Q>a&&(a=Q),Z>p&&(p=Z),F>N&&(N=F),L.length>v&&(v=L.length)}),{maxSons:a,maxChildren:p,maxWives:N,maxOrphans:v}},[$]),f=m.useMemo(()=>[{key:"husbandName",label:"اسم رب/ربة الأسرة رباعي",checked:!0},{key:"husbandID",label:"رقم هوية رب/ربة الأسرة",checked:!0},{key:"husbandJob",label:"عمل رب/ربة الأسرة",checked:!0},{key:"husbandBirthDate",label:"تاريخ ميلاد رب/ربة الأسرة",checked:!0},{key:"husbandAge",label:"عمر رب/ربة الأسرة",checked:!0},{key:"hasChronicIllness",label:"هل يعاني رب الأسرة من مرض مزمن",checked:!0},{key:"chronicIllnessType",label:"نوع مرض رب الأسرة المزمن",checked:!0},{key:"hasDisability",label:"هل يعاني رب الأسرة من إعاقة",checked:!0},{key:"disabilityType",label:"نوع إعاقة رب الأسرة",checked:!0},{key:"hasWarInjury",label:"هل يعاني رب الأسرة من إصابة حرب",checked:!0},{key:"warInjuryType",label:"نوع إصابة حرب رب الأسرة",checked:!0},...Le>0?[{key:"wifeName",label:"اسم الزوج/ة رباعي",checked:!0},{key:"wifeID",label:"رقم هوية الزوج/ة",checked:!0},{key:"wifeJob",label:"عمل الزوج/ة",checked:!0},{key:"wifeBirthDate",label:"تاريخ ميلاد الزوج/ة",checked:!0},{key:"wifeAge",label:"عمر الزوج/ة",checked:!0},{key:"wifePregnant",label:"هل الزوج/ة حامل",checked:!0},{key:"wifeHasChronicIllness",label:"هل يعاني/تعاني الزوج/ة من مرض مزمن",checked:!0},{key:"wifeChronicIllnessType",label:"نوع مرض الزوج/ة المزمن",checked:!0},{key:"wifeHasDisability",label:"هل يعاني/تعاني الزوج/ة من إعاقة",checked:!0},{key:"wifeDisabilityType",label:"نوع إعاقة الزوج/ة",checked:!0},{key:"wifeHasWarInjury",label:"هل يعاني/تعاني الزوج/ة من إصابة حرب",checked:!0},{key:"wifeWarInjuryType",label:"نوع إصابة حرب الزوج/ة",checked:!0}]:[],{key:"primaryPhone",label:"رقم الجوال للتواصل",checked:!0},{key:"secondaryPhone",label:"رقم الجوال البديل",checked:!0},{key:"originalResidence",label:"السكن الأصلي",checked:!0},{key:"currentHousing",label:"حالة السكن الحالي",checked:!0},{key:"displacedLocation",label:"اقرب معلم لك في حال كنت نازح حاليا",checked:!0},{key:"warDamageDescription",label:"الاضرار الناجمة عن حرب 2023",checked:!0},{key:"branch",label:"الفرع",checked:!0},{key:"totalMembers",label:"عدد افراد الأسرة مع الأب والأم",checked:!0},{key:"hasDisabledMembers",label:"هل يوجد افراد ذوي اعاقة في العائلة",checked:!0},{key:"disabilityTypes",label:"اذا كان يوجد أشخاص ذوي اعاقة اذكر نوع الإعاقة",checked:!0},{key:"hasChildrenUnderTwo",label:"عدد الابناء اقل من سنتين",checked:!0},{key:"hasChildren2To5",label:"عدد الابناء من 2-5 سنوات",checked:!0},{key:"hasChildren6To10",label:"عدد الابناء من 6-10 سنوات",checked:!0},{key:"hasChildren11To15",label:"عدد الابناء من 11-15 سنوات",checked:!0},...ye>0?Array.from({length:ye}).flatMap((s,a)=>[{key:`sonName${a+1}`,label:`اسم الابن ${a+1}`,checked:!0},{key:`sonID${a+1}`,label:`رقم هوية الابن ${a+1}`,checked:!0},{key:`sonBirthDate${a+1}`,label:"تاريخ الميلاد",checked:!0},{key:`sonIsDisabled${a+1}`,label:`هل الابن ${a+1} معاق`,checked:!0},{key:`sonDisabilityType${a+1}`,label:`نوع إعاقة الابن ${a+1}`,checked:!0},{key:`sonHasChronicIllness${a+1}`,label:`هل الابن ${a+1} يعاني من مرض مزمن`,checked:!0},{key:`sonChronicIllnessType${a+1}`,label:`نوع مرض الابن ${a+1} المزمن`,checked:!0},{key:`sonHasWarInjury${a+1}`,label:`هل الابن ${a+1} يعاني من إصابة حرب`,checked:!0},{key:`sonWarInjuryType${a+1}`,label:`نوع إصابة حرب الابن ${a+1}`,checked:!0}]):[],...je>0?Array.from({length:je}).flatMap((s,a)=>[{key:`childName${a+1}`,label:`اسم الطفل رباعي ${a+1}`,checked:!0},{key:`childID${a+1}`,label:`رقم هوية الطفل ${a+1}`,checked:!0},{key:`childBirthDate${a+1}`,label:"تاريخ الميلاد",checked:!0},{key:`childIsDisabled${a+1}`,label:`هل الطفل ${a+1} معاق`,checked:!0},{key:`childDisabilityType${a+1}`,label:`نوع إعاقة الطفل ${a+1}`,checked:!0},{key:`childHasChronicIllness${a+1}`,label:`هل الطفل ${a+1} يعاني من مرض مزمن`,checked:!0},{key:`childChronicIllnessType${a+1}`,label:`نوع مرض الطفل ${a+1} المزمن`,checked:!0},{key:`childHasWarInjury${a+1}`,label:`هل الطفل ${a+1} يعاني من إصابة حرب`,checked:!0},{key:`childWarInjuryType${a+1}`,label:`نوع إصابة حرب الطفل ${a+1}`,checked:!0}]):[],{key:"hasChildrenAboveTwo",label:"هل لديك ابناء أكبر من سنتين",checked:!0},{key:"numMales",label:"عدد الافراد الذكور",checked:!0},{key:"numFemales",label:"عدد الافراد الاناث",checked:!0},{key:"socialStatus",label:"الحالة الاجتماعية لرب الاسرة",checked:!0},{key:"abroadLocation",label:"اسم الدولة إذا كنت مغترب خارج البلاد",checked:!0},{key:"adminNotes",label:"ملاحظات إدارية",checked:!0}],[ye,je,Le,Je]),[W,re]=m.useState({});m.useEffect(()=>{re(s=>{const a={};for(const p of f)a[p.key]=s[p.key]!==void 0?s[p.key]:!0;return a})},[f]);const We=s=>{re(a=>({...a,[s]:!a[s]}))},Oe=s=>{re(a=>{const p={...a},N=f.filter(b=>s==="sons"?b.key.startsWith("son"):b.key.startsWith("child")),v=N.every(b=>a[b.key]);for(const b of N)p[b.key]=!v;return p})},Os=()=>{re(Object.fromEntries(f.map(s=>[s.key,!0])))},Rs=()=>{re(Object.fromEntries(f.map(s=>[s.key,!1])))},He=f.filter(s=>s.key.startsWith("son")),Me=f.filter(s=>s.key.startsWith("child")),Re=f.filter(s=>s.key.startsWith("wife"));f.filter(s=>s.key.startsWith("husband"));const Ge=He.length>0&&He.every(s=>W[s.key]),ze=Me.length>0&&Me.every(s=>W[s.key]);Re.length>0&&Re.every(s=>W[s.key]);const te=f.filter(s=>W[s.key]),Gs=async()=>{try{const s=new na.Workbook,a=s.addWorksheet("قائمة الأسر",{views:[{rightToLeft:!0}]}),p={fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FFC8E6C9"}},font:{color:{argb:"FF000000"},bold:!0,size:16},alignment:{horizontal:"center",vertical:"middle"}},N={fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FFC8E6C9"}},font:{color:{argb:"FF000000"},bold:!0,size:12},alignment:{horizontal:"center",vertical:"middle",wrapText:!0},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}},v={alignment:{horizontal:"center",vertical:"middle",wrapText:!0},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}},b=Array(te.length).fill("");b[0]="قائمة الأسر (تصدير)";const G=a.addRow(b);G.height=30;const L=a.getColumn(te.length).letter;a.mergeCells(`A1:${L}1`),G.getCell(1).style=p,G.getCell(1).alignment={horizontal:"center",vertical:"middle"};const J=a.addRow(te.map(r=>r.label));J.height=30,J.eachCell(r=>{r.style=N,r.alignment={...N.alignment,wrapText:!0}}),(Array.isArray($)?$:[]).forEach(r=>{const ne=Array.isArray(r==null?void 0:r.members)?r.members:[],A=Array.isArray(r==null?void 0:r.orphans)?r.orphans:[],g=[...ne];if(Array.isArray(A)){const t=A.map(x=>({...x,fullName:x.orphanName||x.fullName,memberID:x.orphanID||x.memberID,birthDate:x.orphanBirthDate||x.birthDate,isDisabled:x.isDisabled||x.orphanIsDisabled,disabilityType:x.disabilityType||x.orphanDisabilityType,hasChronicIllness:x.hasChronicIllness||x.orphanHasChronicIllness,chronicIllnessType:x.chronicIllnessType||x.orphanChronicIllnessType,hasWarInjury:x.hasWarInjury||x.orphanHasWarInjury,warInjuryType:x.warInjuryType||x.orphanWarInjuryType,isOrphan:!0}));g.push(...t)}console.log("Exporting family:",{id:r.id,husbandName:r.husbandName,members:ne,orphans:A,allMembers:g,sons:g.filter(t=>!ee(t.birthDate)).map(t=>({fullName:t.fullName,birthDate:t.birthDate})),children:g.filter(t=>ee(t.birthDate)).map(t=>({fullName:t.fullName,birthDate:t.birthDate}))});const i=Array.isArray(g)?g.filter(t=>ee(t.birthDate)):[],c=Array.isArray(g)?g.filter(t=>!ee(t.birthDate)):[],d=r.wife?[r.wife]:r.wifeName?[{wifeName:r.wifeName,wifeID:r.wifeID,wifeJob:r.wifeJob,wifeBirthDate:r.wifeBirthDate,wifePregnant:r.wifePregnant,wifeHasChronicIllness:r.wifeHasChronicIllness,wifeChronicIllnessType:r.wifeChronicIllnessType,wifeHasDisability:r.wifeHasDisability,wifeDisabilityType:r.wifeDisabilityType,wifeHasWarInjury:r.wifeHasWarInjury,wifeWarInjuryType:r.wifeWarInjuryType}]:[],P=Array.isArray(c)?Array.from({length:ye}).map((t,x)=>c[x]||null):[],X=Array.isArray(i)?Array.from({length:je}).map((t,x)=>i[x]||null):[],K=Array.isArray(A)?Array.from({length:Je}).map((t,x)=>A[x]||null):[],ba=d.length>0?[d[0]]:[null],ke=Array.isArray(g)?g.filter(t=>t.isDisabled):[],Qs=Array.isArray(ke)?ke.map(t=>t.disabilityType||"").filter(Boolean).join(", "):"",_e=Array.isArray(te)?te.map(t=>{if(t.key==="wifeName")return d.length>0&&d[0].wifeName||"";if(t.key==="wifeID")return d.length>0&&d[0].wifeID||"";if(t.key==="wifeJob")return d.length>0&&d[0].wifeJob||"";if(t.key==="wifeBirthDate")return d.length>0&&d[0].wifeBirthDate||"";if(t.key==="wifeAge")return d.length>0&&d[0].wifeBirthDate?q(d[0].wifeBirthDate):"";if(t.key==="wifePregnant")return d.length>0?d[0].wifePregnant?"نعم":"لا":"";if(t.key==="wifeHasChronicIllness")return d.length>0?d[0].wifeHasChronicIllness?"نعم":"لا":"";if(t.key==="wifeChronicIllnessType")return d.length>0&&d[0].wifeChronicIllnessType||"";if(t.key==="wifeHasDisability")return d.length>0?d[0].wifeHasDisability?"نعم":"لا":"";if(t.key==="wifeDisabilityType")return d.length>0&&d[0].wifeDisabilityType||"";if(t.key==="wifeHasWarInjury")return d.length>0?d[0].wifeHasWarInjury?"نعم":"لا":"";if(t.key==="wifeWarInjuryType")return d.length>0&&d[0].wifeWarInjuryType||"";const x=typeof t.key=="string"?t.key.match(/^sonName(\d+)$/):null,Ue=typeof t.key=="string"?t.key.match(/^sonID(\d+)$/):null,Ye=typeof t.key=="string"?t.key.match(/^sonBirthDate(\d+)$/):null;if(x){const n=parseInt(x[1],10)-1;if(Array.isArray(c)&&c[n]){const j=c[n];let w=j.fullName||"";if(j.isOrphan){const Se=j.gender==="female"?" (يتيمة)":" (يتيم)";w+=Se}return w}return""}if(Ue){const n=parseInt(Ue[1],10)-1;return Array.isArray(c)&&c[n]&&c[n].memberID||""}if(Ye){const n=parseInt(Ye[1],10)-1;return Array.isArray(c)&&c[n]&&c[n].birthDate||""}const qe=typeof t.key=="string"?t.key.match(/^sonIsDisabled(\d+)$/):null,Qe=typeof t.key=="string"?t.key.match(/^sonDisabilityType(\d+)$/):null,Ze=typeof t.key=="string"?t.key.match(/^sonHasChronicIllness(\d+)$/):null,Xe=typeof t.key=="string"?t.key.match(/^sonChronicIllnessType(\d+)$/):null,Ke=typeof t.key=="string"?t.key.match(/^sonHasWarInjury(\d+)$/):null,es=typeof t.key=="string"?t.key.match(/^sonWarInjuryType(\d+)$/):null;if(qe){const n=parseInt(qe[1],10)-1;return Array.isArray(c)&&c[n]?c[n].isDisabled?"نعم":"لا":""}if(Qe){const n=parseInt(Qe[1],10)-1;return Array.isArray(c)&&c[n]&&c[n].disabilityType||""}if(Ze){const n=parseInt(Ze[1],10)-1;return Array.isArray(c)&&c[n]?c[n].hasChronicIllness?"نعم":"لا":""}if(Xe){const n=parseInt(Xe[1],10)-1;return Array.isArray(c)&&c[n]&&c[n].chronicIllnessType||""}if(Ke){const n=parseInt(Ke[1],10)-1;return Array.isArray(c)&&c[n]?c[n].hasWarInjury?"نعم":"لا":""}if(es){const n=parseInt(es[1],10)-1;return Array.isArray(c)&&c[n]&&c[n].warInjuryType||""}const ss=typeof t.key=="string"?t.key.match(/^childName(\d+)$/):null,as=typeof t.key=="string"?t.key.match(/^childID(\d+)$/):null,rs=typeof t.key=="string"?t.key.match(/^childBirthDate(\d+)$/):null;if(ss){const n=parseInt(ss[1],10)-1;if(Array.isArray(i)&&i[n]){const j=i[n];let w=j.fullName||"";if(j.isOrphan){const Se=j.gender==="female"?" (يتيمة)":" (يتيم)";w+=Se}return w}return""}if(as){const n=parseInt(as[1],10)-1;return Array.isArray(i)&&i[n]&&i[n].memberID||""}if(rs){const n=parseInt(rs[1],10)-1;return Array.isArray(i)&&i[n]&&i[n].birthDate||""}const ts=typeof t.key=="string"?t.key.match(/^childIsDisabled(\d+)$/):null,ls=typeof t.key=="string"?t.key.match(/^childDisabilityType(\d+)$/):null,ns=typeof t.key=="string"?t.key.match(/^childHasChronicIllness(\d+)$/):null,is=typeof t.key=="string"?t.key.match(/^childChronicIllnessType(\d+)$/):null,cs=typeof t.key=="string"?t.key.match(/^childHasWarInjury(\d+)$/):null,ds=typeof t.key=="string"?t.key.match(/^childWarInjuryType(\d+)$/):null;if(ts){const n=parseInt(ts[1],10)-1;return Array.isArray(i)&&i[n]?i[n].isDisabled?"نعم":"لا":""}if(ls){const n=parseInt(ls[1],10)-1;return Array.isArray(i)&&i[n]&&i[n].disabilityType||""}if(ns){const n=parseInt(ns[1],10)-1;return Array.isArray(i)&&i[n]?i[n].hasChronicIllness?"نعم":"لا":""}if(is){const n=parseInt(is[1],10)-1;return Array.isArray(i)&&i[n]&&i[n].chronicIllnessType||""}if(cs){const n=parseInt(cs[1],10)-1;return Array.isArray(i)&&i[n]?i[n].hasWarInjury?"نعم":"لا":""}if(ds){const n=parseInt(ds[1],10)-1;return Array.isArray(i)&&i[n]&&i[n].warInjuryType||""}switch(t.key){case"husbandName":return r.husbandName||"";case"husbandID":return r.husbandID||"";case"husbandJob":return r.husbandJob||"";case"husbandBirthDate":return r.husbandBirthDate||"";case"husbandAge":return r.husbandBirthDate?q(r.husbandBirthDate):"";case"hasChronicIllness":return r.hasChronicIllness?"نعم":"لا";case"chronicIllnessType":return r.chronicIllnessType||"";case"hasDisability":return r.hasDisability?"نعم":"لا";case"disabilityType":return r.disabilityType||"";case"hasWarInjury":return r.hasWarInjury?"نعم":"لا";case"warInjuryType":return r.warInjuryType||"";case"primaryPhone":return r.primaryPhone||"";case"secondaryPhone":return r.secondaryPhone||"";case"originalResidence":return r.originalResidence||"";case"currentHousing":return Ps(r);case"displacedLocation":return r.displacedLocation||"";case"warDamageDescription":return la(r.warDamageDescription)||"";case"branch":return $e(r.branch)||"";case"totalMembers":return r.totalMembers||"";case"hasDisabledMembers":return Array.isArray(ke)&&ke.length>0?"نعم":"لا";case"disabilityTypes":return Qs;case"hasChildrenUnderTwo":return Array.isArray(i)?i.filter(n=>n.birthDate?q(n.birthDate)<2:!1).length:0;case"hasChildren2To5":return(Array.isArray(g)?g.filter(j=>{if(!j.birthDate)return!1;const w=q(j.birthDate);return w>=2&&w<=5}):[]).length;case"hasChildren6To10":return(Array.isArray(g)?g.filter(j=>{if(!j.birthDate)return!1;const w=q(j.birthDate);return w>=6&&w<=10}):[]).length;case"hasChildren11To15":return(Array.isArray(g)?g.filter(j=>{if(!j.birthDate)return!1;const w=q(j.birthDate);return w>=11&&w<=15}):[]).length;case"hasChildrenAboveTwo":return Array.isArray(c)&&c.length>0?"نعم":"لا";case"numMales":return r.numMales||"";case"numFemales":return r.numFemales||"";case"socialStatus":return r.socialStatus?ta(r.socialStatus):"";case"abroadLocation":return r.abroadLocation||"";case"adminNotes":return r.adminNotes||"";default:return""}}):[];console.log("Excel rowData:",{familyId:r.id,husbandName:r.husbandName,rowData:_e,sons:c,children:i,orphans:A});const Ve=a.addRow(_e);Ve.height=25,Ve.eachCell(t=>{t.style=v,t.alignment={...v.alignment,wrapText:!0}})});const Q=r=>r.includes("Name")||r.includes("name")||r.includes("اسم")||r.includes("Notes")||r.includes("ملاحظات")||r.includes("originalResidence")||r.includes("displacedLocation")||r.includes("warDamageDescription")||r.includes("disabilityTypes")||r.includes("abroadLocation")?40:r.includes("Job")||r.includes("عمل")||r.includes("branch")||r.includes("فرع")||r.includes("currentHousing")||r.includes("socialStatus")?28:r.includes("Phone")||r.includes("جوال")?24:r.includes("ID")||r.includes("هوية")||r.includes("BirthDate")||r.includes("ميلاد")||r.includes("Age")||r.includes("عمر")?20:r.includes("num")||r.includes("عدد")||r.includes("total")||r.includes("has")||r.includes("Pregnant")||r.includes("حامل")?18:22,Z=f.filter(r=>W[r.key]);a.columns.forEach((r,ne)=>{const A=Z[ne];A?r.width=Q(A.key):r.width=20});let F;ae.trim()?F=ae.trim().endsWith(".xlsx")?ae.trim():ae.trim()+".xlsx":F=`families_export_${new Date().toISOString().split("T")[0]}.xlsx`;const B=await s.xlsx.writeBuffer(),u=new Blob([B],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),we=window.URL.createObjectURL(u),le=document.createElement("a");le.href=we,le.download=F,le.click(),window.URL.revokeObjectURL(we),he({title:"تم التصدير بنجاح",description:`تم حفظ ملف Excel باسم: ${F}`,variant:"default"}),Te("")}catch{he({title:"خطأ في التصدير",description:"حدث خطأ أثناء تصدير البيانات إلى Excel",variant:"destructive"})}},Ne=Math.ceil($.length/Ie),zs=$.slice((S-1)*Ie,S*Ie),_s=s=>{ws(s),Be(!0)};if(Es)return e.jsx(js,{children:e.jsx(ma,{})});const Vs=(y==null?void 0:y.length)||0,Us=(y==null?void 0:y.filter(s=>s.isDisplaced))||[],Ys=(y==null?void 0:y.filter(s=>s.warDamage2023))||[],qs=(y==null?void 0:y.filter(s=>s.isAbroad))||[];return e.jsx(js,{children:e.jsxs("div",{className:"space-y-6 w-full min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"إدارة الأسر"}),e.jsx("p",{className:"text-muted-foreground",children:"عرض وإدارة بيانات جميع الأسر المسجلة"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(H,{children:e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(ve,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي الأسر"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:Vs})]})]})})}),e.jsx(H,{children:e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-destructive/10 rounded-lg",children:e.jsx(ia,{className:"h-6 w-6 text-destructive"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"أسر نازحة"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:Us.length})]})]})})}),e.jsx(H,{children:e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-warning/10 rounded-lg",children:e.jsx(ve,{className:"h-6 w-6 text-warning"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"أسر متضررة"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:Ys.length})]})]})})}),e.jsx(H,{children:e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-secondary/10 rounded-lg",children:e.jsx(ve,{className:"h-6 w-6 text-secondary"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"مغتربون"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:qs.length})]})]})})})]}),e.jsxs(H,{className:"mb-8",children:[e.jsx(ie,{children:e.jsx(us,{children:"البحث والتصفية"})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative w-full max-w-md",children:[e.jsx(ca,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(se,{placeholder:"البحث بالاسم، رقم الهوية، أو الموقع...",value:k,onChange:s=>Ns(s.target.value),className:"pl-10 text-right",dir:"rtl"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"الفرع"}),e.jsxs(z,{value:oe,onValueChange:Ds,dir:"rtl",children:[e.jsx(_,{className:"w-full text-right",dir:"rtl",children:e.jsx(V,{className:"text-right"})}),e.jsxs(U,{dir:"rtl",children:[e.jsx(o,{value:"all",children:"كل الفروع"}),e.jsx(o,{value:"abushalbia",children:"ابو شلبية (شلف - علاينة - عزايزة)"}),e.jsx(o,{value:"alnaqra",children:"النقرة (الدوار)"}),e.jsx(o,{value:"abuawda",children:"ابو عودة"}),e.jsx(o,{value:"abunasr",children:"ابو نصر"}),e.jsx(o,{value:"abumatar",children:"ابو مطر"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"نازح"}),e.jsxs(z,{value:ue,onValueChange:Is,dir:"rtl",children:[e.jsx(_,{className:"w-full text-right",dir:"rtl",children:e.jsx(V,{className:"text-right"})}),e.jsxs(U,{dir:"rtl",children:[e.jsx(o,{value:"all",children:"كل الحالات"}),e.jsx(o,{value:"yes",children:"نازح"}),e.jsx(o,{value:"no",children:"غير نازح"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"متضرر"}),e.jsxs(z,{value:xe,onValueChange:As,dir:"rtl",children:[e.jsx(_,{className:"w-full text-right",dir:"rtl",children:e.jsx(V,{className:"text-right"})}),e.jsxs(U,{dir:"rtl",children:[e.jsx(o,{value:"all",children:"كل الحالات"}),e.jsx(o,{value:"yes",children:"متضرر"}),e.jsx(o,{value:"no",children:"غير متضرر"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"مغترب"}),e.jsxs(z,{value:me,onValueChange:Cs,dir:"rtl",children:[e.jsx(_,{className:"w-full text-right",dir:"rtl",children:e.jsx(V,{className:"text-right"})}),e.jsxs(U,{dir:"rtl",children:[e.jsx(o,{value:"all",children:"كل الحالات"}),e.jsx(o,{value:"yes",children:"مغترب"}),e.jsx(o,{value:"no",children:"غير مغترب"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"الحالة الاجتماعية"}),e.jsxs(z,{value:pe,onValueChange:Ts,dir:"rtl",children:[e.jsx(_,{className:"w-full text-right",dir:"rtl",children:e.jsx(V,{className:"text-right"})}),e.jsxs(U,{dir:"rtl",children:[e.jsx(o,{value:"all",children:"جميع الحالات"}),e.jsx(o,{value:"married",children:"متزوج"}),e.jsx(o,{value:"polygamous",children:"متعدد زوجات"}),e.jsx(o,{value:"widowed",children:"ارملة"}),e.jsx(o,{value:"vulnerable_family",children:"اسر هشة (ايتام)"}),e.jsx(o,{value:"abandoned",children:"متروكة"}),e.jsx(o,{value:"divorced",children:"مطلقة"}),e.jsx(o,{value:"single",children:"عانس"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"عدد الأفراد"}),e.jsxs(z,{value:E,onValueChange:Hs,dir:"rtl",children:[e.jsx(_,{className:"w-full text-right",dir:"rtl",children:e.jsx(V,{className:"text-right"})}),e.jsxs(U,{dir:"rtl",children:[e.jsx(o,{value:"all",children:"جميع الأحجام"}),e.jsx(o,{value:"small",children:"صغيرة (1-3)"}),e.jsx(o,{value:"medium",children:"متوسطة (4-6)"}),e.jsx(o,{value:"large",children:"كبيرة (7+)"}),e.jsx(o,{value:"custom",children:"مخصص"})]})]}),E==="custom"&&e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 w-full",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground block text-center",children:"الحد الأدنى"}),e.jsx(se,{type:"number",min:"0",value:fe,onChange:s=>Ms(s.target.value),placeholder:"0",className:"text-xs text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground block text-center",children:"الحد الأقصى"}),e.jsx(se,{type:"number",min:"0",value:be,onChange:s=>Ss(s.target.value),placeholder:"10",className:"text-xs text-right"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"أم حامل"}),e.jsxs(z,{value:ge,onValueChange:Ws,dir:"rtl",children:[e.jsx(_,{className:"w-full text-right",dir:"rtl",children:e.jsx(V,{className:"text-right"})}),e.jsxs(U,{dir:"rtl",children:[e.jsx(o,{value:"all",children:"جميع الحالات"}),e.jsx(o,{value:"yes",children:"نعم"}),e.jsx(o,{value:"no",children:"لا"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"mb-1 text-sm text-foreground text-center w-full",children:"العمر"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"الأبناء أو الأيتام"}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(se,{type:"number",min:"0",max:"150",value:D,onChange:s=>Fs(s.target.value),placeholder:"من",className:"text-xs text-right",dir:"rtl"}),e.jsx(se,{type:"number",min:"0",max:"150",value:I,onChange:s=>Bs(s.target.value),placeholder:"إلى",className:"text-xs text-right",dir:"rtl"})]})]})]})]})})]}),e.jsxs(H,{children:[e.jsx(ie,{children:e.jsxs(us,{children:["قائمة الأسر (",$.length,")"]})}),e.jsx(M,{children:$.length>0?e.jsxs("div",{className:"overflow-x-auto w-full",children:[e.jsxs("table",{className:"w-full min-w-[800px]",children:[e.jsx("thead",{className:"bg-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 md:px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"رب الأسرة"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"رقم الهوية"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"أفراد الأسرة"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider hidden lg:table-cell",children:"تاريخ التسجيل"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"bg-card divide-y divide-border",children:zs.map(s=>e.jsxs("tr",{className:"hover:bg-muted",children:[e.jsx("td",{className:"px-3 md:px-6 py-4",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-foreground truncate",children:s.husbandName}),s.primaryPhone&&e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center truncate",children:[e.jsx(da,{className:"h-3 w-3 ml-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.primaryPhone})]})]})}),e.jsx("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-sm text-foreground",children:s.husbandID}),e.jsxs("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-center",children:[e.jsx("div",{className:"text-sm font-medium text-foreground",children:s.totalMembers||0}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.numMales||0," ذكور، ",s.numFemales||0," إناث"]})]}),e.jsx("td",{className:"px-3 md:px-6 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-[120px]",children:[s.isDisplaced&&e.jsx(T,{variant:"destructive",className:"text-xs",children:"نازح"}),s.warDamage2023&&e.jsx(T,{variant:"outline",className:"text-xs",children:"متضرر"}),s.isAbroad&&e.jsx(T,{className:"bg-primary/10 text-primary text-xs",children:"مغترب"})]})}),e.jsx("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-sm text-muted-foreground hidden lg:table-cell",children:xs(s.createdAt)}),e.jsx("td",{className:"px-3 md:px-6 py-4 text-sm",children:e.jsxs("div",{className:"flex flex-wrap gap-1 md:flex-nowrap md:space-x-2 md:space-x-reverse min-w-[140px]",children:[e.jsx(C,{variant:"outline",size:"sm",onClick:()=>_s(s),className:"w-8 h-8 p-0",children:e.jsx(ha,{className:"h-4 w-4"})}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>vs(`/admin/families/${s.id}/edit`),className:"w-8 h-8 p-0",children:e.jsx(oa,{className:"h-4 w-4"})}),e.jsx(sa,{href:`/admin/families/${s.id}/summary`,target:"_blank",children:e.jsx(C,{variant:"outline",size:"sm",className:"w-8 h-8 p-0",children:e.jsx(xa,{className:"h-4 w-4"})})}),e.jsx(C,{size:"sm",variant:"destructive",onClick:()=>{window.confirm("هل أنت متأكد أنك تريد حذف هذه الأسرة؟ سيتم حذف جميع الأفراد والبيانات المرتبطة بها.")&&Js.mutate(s.id)},className:"w-8 h-8 p-0",children:e.jsx(ua,{className:"h-4 w-4"})})]})})]},s.id))})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{variant:"outline",size:"sm",disabled:S===1,onClick:()=>de(1),children:"الأول"}),e.jsx(C,{variant:"outline",size:"sm",disabled:S===1,onClick:()=>de(S-1),children:"السابق"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["صفحة ",S," من ",Ne]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{variant:"outline",size:"sm",disabled:S===Ne,onClick:()=>de(S+1),children:"التالي"}),e.jsx(C,{variant:"outline",size:"sm",disabled:S===Ne,onClick:()=>de(Ne),children:"الأخير"})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:k?"لم يتم العثور على أسر تطابق البحث":"لا توجد أسر مسجلة"})]})})]}),e.jsx(gs,{open:ks,onOpenChange:Be,children:e.jsxs(fs,{className:"max-w-4xl max-h-[90vh] w-[95vw] md:w-full overflow-y-auto",children:[e.jsx(bs,{children:e.jsxs(ys,{className:"text-center w-full",children:["تفاصيل الأسرة - ",(l==null?void 0:l.husbandName)||""]})}),Ls?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"text-muted-foreground",children:"جاري تحميل التفاصيل..."})}):Ee?e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-red-600",children:[e.jsx("div",{children:"حدث خطأ أثناء تحميل بيانات الأسرة."}),e.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:Ee.message||"يرجى المحاولة مرة أخرى لاحقاً."})]}):l?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-background rounded-lg p-4 border mb-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-2",children:[e.jsxs(T,{className:"bg-blue-100 text-blue-800",children:["رقم الأسرة: ",l.id]}),l.isDisplaced&&e.jsx(T,{variant:"destructive",children:"نازح"}),l.warDamage2023&&e.jsx(T,{variant:"outline",children:"متضرر"}),l.isAbroad&&e.jsx(T,{className:"bg-blue-100 text-blue-800",children:"مغترب"}),l.branch&&e.jsx(T,{className:"bg-green-100 text-green-800",children:$e(l.branch)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"العنوان الأصلي:"}),e.jsx("span",{className:"mr-2",children:l.originalResidence||"غير محدد"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"مكان السكن الحالي:"}),e.jsx("span",{className:"mr-2",children:l.currentHousing||"غير محدد"})]}),l.isDisplaced&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"موقع النزوح:"}),e.jsx("span",{className:"mr-2",children:l.displacedLocation||"غير محدد"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"أقرب معلم:"}),e.jsx("span",{className:"mr-2",children:l.landmarkNear||"غير محدد"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"ملاحظات الإدارة:"}),e.jsx("span",{className:"mr-2",children:l.adminNotes||"لا يوجد"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 md:p-4 border",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex flex-wrap items-center gap-2",children:["رب الأسرة ",e.jsx(T,{className:"bg-blue-200 text-blue-900",children:l.husbandName})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"رقم الهوية:"})," ",e.jsx("span",{className:"sm:mr-2",children:l.husbandID})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"تاريخ الميلاد:"})," ",e.jsxs("span",{className:"sm:mr-2",children:[l.husbandBirthDate||"غير محدد",l.husbandBirthDate&&e.jsxs(e.Fragment,{children:[" (",e.jsx("span",{className:"text-green-700",children:De(l.husbandBirthDate)}),")"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"المهنة:"})," ",e.jsx("span",{className:"sm:mr-2",children:l.husbandJob||"غير محدد"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"المرض المزمن:"})," ",e.jsx("span",{className:"sm:mr-2",children:l.hasChronicIllness?l.chronicIllnessType||"نعم":"لا"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الإعاقة:"})," ",e.jsx("span",{className:"sm:mr-2",children:l.hasDisability?l.disabilityType||"نعم":"لا"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الجوال:"})," ",e.jsx("span",{className:"sm:mr-2",children:l.primaryPhone||"غير محدد"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الجوال الإضافي:"})," ",e.jsx("span",{className:"sm:mr-2",children:l.secondaryPhone||"غير محدد"})]})]})]}),(l.spouse||l.wifeName)&&e.jsxs("div",{className:"bg-card rounded-lg p-3 md:p-4 border",children:[e.jsx("h4",{className:"font-semibold text-card-foreground mb-3",children:l.userGender==="female"?"الزوج":"الزوجة"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:e.jsx(T,{variant:"secondary",children:l.userGender==="female"?l.spouseAsHusbandName:l.spouseAsWifeName})}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"رقم الهوية:"})," ",e.jsx("span",{className:"sm:mr-2",children:l.userGender==="female"?l.spouseAsHusbandID:l.spouseAsWifeID||"غير محدد"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"تاريخ الميلاد:"})," ",e.jsxs("span",{className:"sm:mr-2",children:[(l.userGender==="female"?l.spouseAsHusbandBirthDate:l.spouseAsWifeBirthDate)||"غير محدد",(l.userGender==="female"?l.spouseAsHusbandBirthDate:l.spouseAsWifeBirthDate)&&e.jsxs(e.Fragment,{children:[" (",e.jsx("span",{className:"text-primary",children:De(l.userGender==="female"?l.spouseAsHusbandBirthDate:l.spouseAsWifeBirthDate)}),")"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"المهنة:"})," ",e.jsx("span",{className:"sm:mr-2",children:l.userGender==="female"?l.spouseAsHusbandJob:l.spouseAsWifeJob||"غير محدد"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"المرض المزمن:"})," ",e.jsx("span",{className:"sm:mr-2",children:(l.userGender==="female"?l.spouseAsHusbandHasChronicIllness:l.spouseAsWifeHasChronicIllness)?(l.userGender==="female"?l.spouseAsHusbandChronicIllnessType:l.spouseAsWifeChronicIllnessType)||"نعم":"لا"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الإعاقة:"})," ",e.jsx("span",{className:"sm:mr-2",children:(l.userGender==="female"?l.spouseAsHusbandHasDisability:l.spouseAsWifeHasDisability)?(l.userGender==="female"?l.spouseAsHusbandDisabilityType:l.spouseAsWifeDisabilityType)||"نعم":"لا"})]}),l.userGender!=="female"&&e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"حامل:"})," ",e.jsx("span",{className:"sm:mr-2",children:(l.userGender==="female"?l.spouseAsHusbandPregnant:l.spouseAsWifePregnant)?e.jsx(T,{variant:"outline",className:"border-warning text-warning",children:"نعم"}):"لا"})]})]})]})]})]}),l.members&&l.members.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground mb-3",children:"أفراد الأسرة"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"block md:hidden space-y-2",children:l.members.map(s=>e.jsxs("div",{className:"border rounded-lg p-3 text-sm",children:[e.jsx("div",{className:"font-medium mb-1",children:s.fullName}),e.jsxs("div",{className:"text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["الجنس: ",ms(s.gender)]}),e.jsxs("div",{children:["القرابة: ",ps(s.relationship)]}),e.jsxs("div",{children:["تاريخ الميلاد: ",s.birthDate||"غير محدد",s.birthDate&&e.jsxs(e.Fragment,{children:[" (",e.jsx("span",{className:"text-primary",children:De(s.birthDate)}),")"]})]}),e.jsxs("div",{children:["الإعاقة: ",s.isDisabled?s.disabilityType||"نعم":"لا"]}),e.jsxs("div",{children:["المرض المزمن: ",s.hasChronicIllness?s.chronicIllnessType||"نعم":"لا"]})]})]},s.id))}),e.jsxs("table",{className:"hidden md:table w-full text-sm",children:[e.jsx("thead",{className:"bg-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-right",children:"الاسم"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"الجنس"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"القرابة"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"تاريخ الميلاد"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"إعاقة"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"مرض مزمن"})]})}),e.jsx("tbody",{children:l.members.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-3 py-2",children:s.fullName}),e.jsx("td",{className:"px-3 py-2",children:ms(s.gender)}),e.jsx("td",{className:"px-3 py-2",children:ps(s.relationship)}),e.jsxs("td",{className:"px-3 py-2",children:[s.birthDate||"غير محدد",s.birthDate&&e.jsxs(e.Fragment,{children:[" (",e.jsx("span",{className:"text-primary",children:De(s.birthDate)}),")"]})]}),e.jsx("td",{className:"px-3 py-2",children:s.isDisabled?s.disabilityType||"نعم":"لا"}),e.jsx("td",{className:"px-3 py-2",children:s.hasChronicIllness?s.chronicIllnessType||"نعم":"لا"})]},s.id))})]})]})]}):e.jsx("div",{className:"text-center text-muted-foreground",children:"لا يوجد أفراد مسجلين لهذه الأسرة."}),l.requests&&l.requests.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground mb-3",children:"الطلبات الأخيرة"}),e.jsx("div",{className:"space-y-2",children:l.requests.slice(0,3).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-background rounded border",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium",children:aa(s.type)}),e.jsx("span",{className:"text-muted-foreground text-xs",children:xs(s.createdAt)})]}),e.jsx(T,{variant:s.status==="approved"?"default":s.status==="rejected"?"destructive":"secondary",className:s.status==="approved"?"bg-primary text-primary-foreground":s.status==="rejected"?"":"bg-warning text-warning-foreground",children:ra(s.status)})]},s.id))})]}):e.jsx("div",{className:"text-center text-muted-foreground",children:"لا توجد طلبات حديثة لهذه الأسرة."})]}):e.jsx("div",{className:"flex flex-col items-center justify-center h-32 text-muted-foreground",children:e.jsx("div",{children:"لا توجد بيانات متاحة لهذه الأسرة."})})]})}),e.jsx("div",{className:"flex justify-end mb-6",children:e.jsxs(C,{onClick:()=>Pe(!0),variant:"outline",className:"flex items-center gap-2 justify-center",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"تصدير إلى Excel"}),e.jsx("span",{className:"sm:hidden",children:"تصدير"})]})}),e.jsx(gs,{open:$s,onOpenChange:s=>{Pe(s),s||Te("")},children:e.jsxs(fs,{className:"max-w-4xl max-h-[90vh] w-[95vw] overflow-y-auto",children:[e.jsxs(bs,{className:"px-4 sm:px-6",children:[e.jsxs(ys,{className:"flex items-center gap-2 text-lg sm:text-xl font-bold",children:[e.jsx(Fe,{className:"h-5 w-5"}),e.jsx("span",{children:"تصدير بيانات الأسر إلى Excel"})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-right",children:"حدد الأعمدة التي ترغب في تضمينها في التصدير"})]}),e.jsxs("div",{className:"px-4 sm:px-6 py-4",children:[e.jsxs("div",{className:"flex justify-end gap-2 mb-4",children:[e.jsx(C,{type:"button",variant:"outline",onClick:Os,className:"text-sm",children:"تحديد الكل"}),e.jsx(C,{type:"button",variant:"outline",onClick:Rs,className:"text-sm",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 mb-4",dir:"rtl",children:[f.filter(s=>s.key.startsWith("husband")).map((s,a)=>e.jsxs("label",{className:`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-all select-none shadow-sm ${W[s.key]??!0?"bg-green-50 border-green-500 text-green-800 font-bold ring-2 ring-green-200":"bg-white border-gray-200 text-gray-700 hover:border-green-300"}`,style:{order:a+1},children:[e.jsx("input",{type:"checkbox",checked:W[s.key]??!0,onChange:()=>We(s.key),className:"accent-green-600 w-4 h-4"}),e.jsx("span",{className:"text-sm",children:s.label})]},s.key)),f.filter(s=>s.key.startsWith("wife")).map((s,a)=>e.jsxs("label",{className:`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-all select-none shadow-sm ${W[s.key]??!0?"bg-green-50 border-green-500 text-green-800 font-bold ring-2 ring-green-200":"bg-white border-gray-200 text-gray-700 hover:border-green-300"}`,style:{order:a+f.filter(p=>p.key.startsWith("husband")).length+1},children:[e.jsx("input",{type:"checkbox",checked:W[s.key]??!0,onChange:()=>We(s.key),className:"accent-green-600 w-4 h-4"}),e.jsx("span",{className:"text-sm",children:s.label})]},s.key)),He.length>0&&e.jsxs("label",{className:`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-all select-none shadow-sm ${Ge?"bg-green-50 border-green-500 text-green-800 font-bold ring-2 ring-green-200":"bg-white border-gray-200 text-gray-700 hover:border-green-300"}`,style:{order:f.filter(s=>s.key.startsWith("husband")).length+f.filter(s=>s.key.startsWith("wife")).length+1},children:[e.jsx("input",{type:"checkbox",checked:Ge,onChange:()=>Oe("sons"),className:"accent-green-600 w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"الأبناء"})]}),Me.length>0&&e.jsxs("label",{className:`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-all select-none shadow-sm ${ze?"bg-green-50 border-green-500 text-green-800 font-bold ring-2 ring-green-200":"bg-white border-gray-200 text-gray-700 hover:border-green-300"}`,style:{order:f.filter(s=>s.key.startsWith("husband")).length+f.filter(s=>s.key.startsWith("wife")).length+2},children:[e.jsx("input",{type:"checkbox",checked:ze,onChange:()=>Oe("children"),className:"accent-green-600 w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"الأطفال"})]}),f.filter(s=>!s.key.startsWith("son")&&!s.key.startsWith("child")&&!s.key.startsWith("orphan")&&!s.key.startsWith("wife")&&!s.key.startsWith("husband")).map((s,a)=>e.jsxs("label",{className:`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-all select-none shadow-sm ${W[s.key]??!0?"bg-green-50 border-green-500 text-green-800 font-bold ring-2 ring-green-200":"bg-white border-gray-200 text-gray-700 hover:border-green-300"}`,style:{order:a+f.filter(p=>p.key.startsWith("husband")).length+f.filter(p=>p.key.startsWith("wife")).length+3},children:[e.jsx("input",{type:"checkbox",checked:W[s.key]??!0,onChange:()=>We(s.key),className:"accent-green-600 w-4 h-4"}),e.jsx("span",{className:"text-sm",children:s.label})]},s.key))]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-right mb-2",children:"اسم ملف التصدير (اختياري)"}),e.jsx(se,{value:ae,onChange:s=>Te(s.target.value),placeholder:"أدخل اسم الملف (مثلاً: الأسر_المسجلة_٢٠٢٥)",className:"w-full text-right"})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs(C,{onClick:()=>Gs(),className:"bg-green-600 text-white hover:bg-green-700 flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"تصدير إلى Excel"]})})]})]})})]})})});export{Sa as default};
