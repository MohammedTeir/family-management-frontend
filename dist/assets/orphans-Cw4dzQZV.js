import{r as f,v as Z,j as e,x as l,I as c,S as A,m as C,n as k,p as B,q as i,B as x,A as ee,E as se,G as m,H as T,F as R,t as le,c as de,w as H,b as ce,C as F,d as _,U,K as oe,e as ne,f as xe,M as q,y as G,D as E,O as L}from"./index-ZYzdAsGm.js";import{D as ie,a as he,b as ue,c as pe}from"./dialog-S7UO55CL.js";import{a as K}from"./dropdown-menu-C5FzIU9D.js";import{c as ge}from"./image-compression-C0mNLyVZ.js";import{A as Ne,a as je,b as be,c as fe,d as ye,e as ve,f as Ie,g as we}from"./alert-dialog-BGXVV_jb.js";import{H as J}from"./header-qJrll5lw.js";import{P as Te}from"./plus-hSYWIs9K.js";import{P as X,T as Y}from"./trash-2-BvJN9095.js";import"./index-CvI2JamZ.js";const Se=se({orphanName:m().min(1,"اسم اليتيم مطلوب"),orphanBirthDate:m().min(1,"تاريخ ميلاد اليتيم مطلوب"),orphanID:m().regex(/^\d{9}$/,"رقم هوية اليتيم يجب أن يكون 9 أرقام").min(1,"رقم الهوية مطلوب"),gender:R(["male","female"],{errorMap:(r,h)=>r.code==="invalid_enum_value"?{message:"الجنس مطلوب"}:{message:h.defaultError}}),guardianName:m().min(1,"اسم الوصي مطلوب"),guardianID:m().regex(/^\d{9}$/,"رقم هوية الوصي يجب أن يكون 9 أرقام").min(1,"رقم هوية الوصي مطلوب"),guardianBirthDate:m().min(1,"تاريخ ميلاد الوصي مطلوب"),fatherName:m().min(1,"اسم الاب مطلوب"),fatherID:m().regex(/^\d{9}$/,"رقم هوية الاب يجب أن يكون 9 أرقام").min(1,"رقم هوية الاب مطلوب"),martyrdomDate:m().min(1,"تاريخ الاستشهاد مطلوب"),martyrdomType:R(["war_2023","pre_2023_war","natural_death"],{errorMap:(r,h)=>r.code==="invalid_enum_value"?{message:"حالة الوفاة مطلوبة"}:{message:h.defaultError}}),hasChronicIllness:T().optional(),chronicIllnessType:m().optional(),isDisabled:T().optional(),disabilityType:m().optional(),hasWarInjury:T().optional(),warInjuryType:m().optional(),bankAccountNumber:m().min(1,"رقم حساب البنك مطلوب"),accountHolderName:m().min(1,"اسم صاحب الحساب مطلوب"),currentAddress:m().min(1,"العنوان الحالي مطلوب"),originalAddress:m().min(1,"العنوان الاصلي مطلوب"),mobileNumber:m().regex(/^\d{10}$/,"رقم الجوال يجب أن يكون 10 أرقام").min(1,"رقم الجوال مطلوب"),backupMobileNumber:m().regex(/^\d{10}$/,"رقم الجوال الاحتياطي يجب أن يكون 10 أرقام").min(1,"رقم الجوال الاحتياطي مطلوب"),image:m().optional()});function Ae({initialData:r,onSubmit:h,onCancel:p,isLoading:u=!1,isEdit:g=!1}){const[o,N]=f.useState(null),t=Z({resolver:ee(Se),defaultValues:{orphanName:(r==null?void 0:r.orphanName)||"",orphanBirthDate:(r==null?void 0:r.orphanBirthDate)||"",orphanID:(r==null?void 0:r.orphanID)||"",gender:(r==null?void 0:r.gender)||"",guardianName:(r==null?void 0:r.guardianName)||"",guardianID:(r==null?void 0:r.guardianID)||"",guardianBirthDate:(r==null?void 0:r.guardianBirthDate)||"",fatherName:(r==null?void 0:r.fatherName)||"",fatherID:(r==null?void 0:r.fatherID)||"",martyrdomDate:(r==null?void 0:r.martyrdomDate)||"",martyrdomType:(r==null?void 0:r.martyrdomType)||"",hasChronicIllness:(r==null?void 0:r.hasChronicIllness)||!1,chronicIllnessType:(r==null?void 0:r.chronicIllnessType)||"",isDisabled:(r==null?void 0:r.isDisabled)||!1,disabilityType:(r==null?void 0:r.disabilityType)||"",hasWarInjury:(r==null?void 0:r.hasWarInjury)||!1,warInjuryType:(r==null?void 0:r.warInjuryType)||"",bankAccountNumber:(r==null?void 0:r.bankAccountNumber)||"",accountHolderName:(r==null?void 0:r.accountHolderName)||"",currentAddress:(r==null?void 0:r.currentAddress)||"",originalAddress:(r==null?void 0:r.originalAddress)||"",mobileNumber:(r==null?void 0:r.mobileNumber)||"",backupMobileNumber:(r==null?void 0:r.backupMobileNumber)||"",image:(r==null?void 0:r.image)||""}});f.useEffect(()=>()=>{o&&o.startsWith("blob:")&&URL.revokeObjectURL(o)},[o]);const S=d=>{h(d)};return e.jsxs("form",{onSubmit:t.handleSubmit(S),className:"space-y-3 sm:space-y-4 lg:space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"orphanName",className:"text-sm sm:text-base font-medium",children:"اسم اليتيم *"}),e.jsx(c,{id:"orphanName",placeholder:"اسم اليتيم",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("orphanName")}),t.formState.errors.orphanName&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.orphanName.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"orphanID",className:"text-sm sm:text-base font-medium",children:"رقم هوية اليتيم *"}),e.jsx(c,{id:"orphanID",placeholder:"رقم هوية اليتيم",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("orphanID")}),t.formState.errors.orphanID&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.orphanID.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"orphanBirthDate",className:"text-sm sm:text-base font-medium",children:"تاريخ ميلاد اليتيم *"}),e.jsx(c,{id:"orphanBirthDate",type:"date",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("orphanBirthDate")}),t.formState.errors.orphanBirthDate&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.orphanBirthDate.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"gender",className:"text-sm sm:text-base font-medium",children:"الجنس *"}),e.jsxs(A,{value:["male","female"].includes(t.watch("gender")||"")?t.watch("gender"):"",onValueChange:d=>t.setValue("gender",d),dir:"rtl",children:[e.jsx(C,{className:"h-10 sm:h-11 text-sm sm:text-base mt-1",children:e.jsx(k,{placeholder:"اختر الجنس"})}),e.jsxs(B,{dir:"rtl",children:[e.jsx(i,{value:"male",className:"text-sm sm:text-base",children:"ذكر"}),e.jsx(i,{value:"female",className:"text-sm sm:text-base",children:"أنثى"})]})]}),t.formState.errors.gender&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.gender.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"guardianName",className:"text-sm sm:text-base font-medium",children:"اسم الوصي *"}),e.jsx(c,{id:"guardianName",placeholder:"اسم الوصي",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("guardianName")}),t.formState.errors.guardianName&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.guardianName.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"guardianID",className:"text-sm sm:text-base font-medium",children:"رقم هوية الوصي *"}),e.jsx(c,{id:"guardianID",placeholder:"رقم هوية الوصي",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("guardianID")}),t.formState.errors.guardianID&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.guardianID.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"guardianBirthDate",className:"text-sm sm:text-base font-medium",children:"تاريخ ميلاد الوصي *"}),e.jsx(c,{id:"guardianBirthDate",type:"date",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("guardianBirthDate")}),t.formState.errors.guardianBirthDate&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.guardianBirthDate.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"fatherName",className:"text-sm sm:text-base font-medium",children:"اسم الاب *"}),e.jsx(c,{id:"fatherName",placeholder:"اسم الاب",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("fatherName")}),t.formState.errors.fatherName&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.fatherName.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"fatherID",className:"text-sm sm:text-base font-medium",children:"رقم هوية الاب *"}),e.jsx(c,{id:"fatherID",placeholder:"رقم هوية الاب",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("fatherID")}),t.formState.errors.fatherID&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.fatherID.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"martyrdomDate",className:"text-sm sm:text-base font-medium",children:"تاريخ الاستشهاد *"}),e.jsx(c,{id:"martyrdomDate",type:"date",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("martyrdomDate")}),t.formState.errors.martyrdomDate&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.martyrdomDate.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"martyrdomType",className:"text-sm sm:text-base font-medium",children:"حالة الوفاة *"}),e.jsxs(A,{value:["war_2023","pre_2023_war","natural_death"].includes(t.watch("martyrdomType")||"")?t.watch("martyrdomType"):"",onValueChange:d=>t.setValue("martyrdomType",d),dir:"rtl",children:[e.jsx(C,{className:"h-10 sm:h-11 text-sm sm:text-base mt-1",children:e.jsx(k,{placeholder:"اختر حالة الوفاة"})}),e.jsxs(B,{dir:"rtl",children:[e.jsx(i,{value:"war_2023",className:"text-sm sm:text-base",children:"شهيد حرب ٢٠٢٣"}),e.jsx(i,{value:"pre_2023_war",className:"text-sm sm:text-base",children:"شهيد حرب ما قبل ذلك"}),e.jsx(i,{value:"natural_death",className:"text-sm sm:text-base",children:"وفاة طبيعية"})]})]}),t.formState.errors.martyrdomType&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.martyrdomType.message})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx(l,{htmlFor:"hasChronicIllness",className:"text-sm sm:text-base font-medium",children:"هل يعاني من مرض مزمن؟"}),e.jsxs(A,{value:t.watch("hasChronicIllness")?"true":"false",onValueChange:d=>t.setValue("hasChronicIllness",d==="true"),dir:"rtl",children:[e.jsx(C,{className:"h-10 sm:h-11 text-sm sm:text-base mt-1",children:e.jsx(k,{placeholder:"اختر"})}),e.jsxs(B,{dir:"rtl",children:[e.jsx(i,{value:"false",className:"text-sm sm:text-base",children:"لا"}),e.jsx(i,{value:"true",className:"text-sm sm:text-base",children:"نعم"})]})]})]}),t.watch("hasChronicIllness")&&e.jsxs("div",{className:"md:col-span-1",children:[e.jsx(l,{htmlFor:"chronicIllnessType",className:"text-sm sm:text-base font-medium",children:"نوع المرض المزمن"}),e.jsx(c,{id:"chronicIllnessType",placeholder:"نوع المرض المزمن",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("chronicIllnessType")}),t.formState.errors.chronicIllnessType&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.chronicIllnessType.message})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx(l,{htmlFor:"isDisabled",className:"text-sm sm:text-base font-medium",children:"هل يعاني من إعاقة؟"}),e.jsxs(A,{value:t.watch("isDisabled")?"true":"false",onValueChange:d=>t.setValue("isDisabled",d==="true"),dir:"rtl",children:[e.jsx(C,{className:"h-10 sm:h-11 text-sm sm:text-base mt-1",children:e.jsx(k,{placeholder:"اختر"})}),e.jsxs(B,{dir:"rtl",children:[e.jsx(i,{value:"false",className:"text-sm sm:text-base",children:"لا"}),e.jsx(i,{value:"true",className:"text-sm sm:text-base",children:"نعم"})]})]})]}),t.watch("isDisabled")&&e.jsxs("div",{className:"md:col-span-1",children:[e.jsx(l,{htmlFor:"disabilityType",className:"text-sm sm:text-base font-medium",children:"نوع الإعاقة"}),e.jsx(c,{id:"disabilityType",placeholder:"نوع الإعاقة",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("disabilityType")}),t.formState.errors.disabilityType&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.disabilityType.message})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx(l,{htmlFor:"hasWarInjury",className:"text-sm sm:text-base font-medium",children:"هل يعاني من إصابة حرب؟"}),e.jsxs(A,{value:t.watch("hasWarInjury")?"true":"false",onValueChange:d=>t.setValue("hasWarInjury",d==="true"),dir:"rtl",children:[e.jsx(C,{className:"h-10 sm:h-11 text-sm sm:text-base mt-1",children:e.jsx(k,{placeholder:"اختر"})}),e.jsxs(B,{dir:"rtl",children:[e.jsx(i,{value:"false",className:"text-sm sm:text-base",children:"لا"}),e.jsx(i,{value:"true",className:"text-sm sm:text-base",children:"نعم"})]})]})]}),t.watch("hasWarInjury")&&e.jsxs("div",{className:"md:col-span-1",children:[e.jsx(l,{htmlFor:"warInjuryType",className:"text-sm sm:text-base font-medium",children:"نوع إصابة الحرب"}),e.jsx(c,{id:"warInjuryType",placeholder:"نوع إصابة الحرب",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("warInjuryType")}),t.formState.errors.warInjuryType&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.warInjuryType.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"bankAccountNumber",className:"text-sm sm:text-base font-medium",children:"رقم حساب البنك *"}),e.jsx(c,{id:"bankAccountNumber",placeholder:"رقم حساب البنك",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("bankAccountNumber")}),t.formState.errors.bankAccountNumber&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.bankAccountNumber.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"accountHolderName",className:"text-sm sm:text-base font-medium",children:"اسم صاحب الحساب *"}),e.jsx(c,{id:"accountHolderName",placeholder:"اسم صاحب الحساب",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("accountHolderName")}),t.formState.errors.accountHolderName&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.accountHolderName.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"mobileNumber",className:"text-sm sm:text-base font-medium",children:"رقم الجوال *"}),e.jsx(c,{id:"mobileNumber",placeholder:"رقم الجوال",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("mobileNumber")}),t.formState.errors.mobileNumber&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.mobileNumber.message})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"backupMobileNumber",className:"text-sm sm:text-base font-medium",children:"رقم جوال احتياطي *"}),e.jsx(c,{id:"backupMobileNumber",placeholder:"رقم جوال احتياطي",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("backupMobileNumber")}),t.formState.errors.backupMobileNumber&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.backupMobileNumber.message})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(l,{htmlFor:"currentAddress",className:"text-sm sm:text-base font-medium",children:"العنوان الحالي *"}),e.jsx(c,{id:"currentAddress",placeholder:"العنوان الحالي",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("currentAddress")}),t.formState.errors.currentAddress&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.currentAddress.message})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(l,{htmlFor:"originalAddress",className:"text-sm sm:text-base font-medium",children:"العنوان الاصلي *"}),e.jsx(c,{id:"originalAddress",placeholder:"العنوان الاصلي",className:"h-10 sm:h-11 text-sm sm:text-base mt-1 text-right",dir:"rtl",...t.register("originalAddress")}),t.formState.errors.originalAddress&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.originalAddress.message})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(l,{htmlFor:"image",className:"text-sm sm:text-base font-medium",children:"رفع صورة اليتيم"}),e.jsxs("div",{className:"mt-1",children:[e.jsx(c,{id:"image",type:"file",accept:"image/*",className:"hidden",dir:"rtl",onChange:d=>{var w;const j=(w=d.target.files)==null?void 0:w[0];j&&ge(j).then(b=>{const y=URL.createObjectURL(b);N(y);const n=new FileReader;n.onload=()=>{t.setValue("image",n.result),N(n.result),URL.revokeObjectURL(y)},n.readAsDataURL(b)}).catch(b=>{console.error("Error compressing image:",b);const y=URL.createObjectURL(j);N(y);const n=new FileReader;n.onload=()=>{t.setValue("image",n.result),N(n.result),URL.revokeObjectURL(y)},n.readAsDataURL(j)})}}),e.jsxs(x,{type:"button",variant:"outline",className:"w-full justify-between",onClick:()=>{var d;return(d=document.getElementById("image"))==null?void 0:d.click()},children:[e.jsx("span",{className:"text-right flex-1",children:t.watch("image")?"تم اختيار ملف":"اختر ملف"}),e.jsx("span",{className:"text-xs text-muted-foreground mr-2",children:"..."})]})]}),((r==null?void 0:r.image)||o)&&e.jsxs("div",{className:"mt-2",children:[e.jsx(l,{className:"text-sm text-muted-foreground",children:"معاينة الصورة:"}),e.jsx("div",{className:"mt-1 flex justify-center items-center",children:e.jsx("img",{src:o||(r==null?void 0:r.image),alt:"معاينة صورة اليتيم",className:"max-h-32 max-w-full object-contain border rounded",onError:()=>{o&&N(null)}})}),o&&e.jsx("div",{className:"text-xs text-muted-foreground text-center mt-1",children:"هذه معاينة للصورة المحددة حديثاً"}),!o&&(r==null?void 0:r.image)&&e.jsx("div",{className:"text-xs text-muted-foreground text-center mt-1",children:"هذه صورة اليتيم الحالية"})]}),t.formState.errors.image&&e.jsx("p",{className:"text-xs sm:text-sm text-destructive mt-1",children:t.formState.errors.image.message})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-2 sm:space-x-reverse pt-4 sm:pt-6",children:[e.jsx(x,{type:"button",variant:"outline",onClick:p,className:"w-full sm:w-auto px-4 py-2 sm:px-6 sm:py-3 text-sm sm:text-base order-2 sm:order-1",children:"إلغاء"}),e.jsx(x,{type:"submit",disabled:u,className:"w-full sm:w-auto px-4 py-2 sm:px-6 sm:py-3 text-sm sm:text-base order-1 sm:order-2",children:u?"جاري الحفظ...":g?"تحديث":"إضافة"})]})]})}const Ce=se({orphanName:m().min(1,"اسم اليتيم مطلوب"),orphanBirthDate:m().min(1,"تاريخ ميلاد اليتيم مطلوب"),orphanID:m().regex(/^\d{9,15}$/,"رقم هوية اليتيم يجب أن يكون 9-15 رقم").optional(),gender:R(["male","female"],{errorMap:(r,h)=>r.code==="invalid_enum_value"?{message:"الجنس مطلوب"}:{message:h.defaultError}}),guardianName:m().min(1,"اسم الوصي مطلوب"),guardianID:m().regex(/^\d{9,15}$/,"رقم هوية الوصي يجب أن يكون 9-15 رقم").optional(),guardianBirthDate:m().min(1,"تاريخ ميلاد الوصي مطلوب"),fatherName:m().optional(),fatherID:m().regex(/^\d{9,15}$/,"رقم هوية الأب يجب أن يكون 9-15 رقم").optional(),martyrdomDate:m().optional(),hasChronicIllness:T().optional(),chronicIllnessType:m().optional(),isDisabled:T().optional(),disabilityType:m().optional(),hasWarInjury:T().optional(),warInjuryType:m().optional(),bankAccountNumber:m().optional(),accountHolderName:m().optional(),currentAddress:m().optional(),originalAddress:m().optional(),mobileNumber:m().regex(/^[\d\s+\-().]{10,15}$/,"رقم الجوال غير صحيح").optional(),backupMobileNumber:m().regex(/^[\d\s+\-().]{10,15}$/,"رقم الجوال الاحتياطي غير صحيح").optional()});function Le(){const{toast:r}=le(),[h,p]=f.useState(!1),[u,g]=f.useState(null),[o,N]=f.useState(null),[t,S]=f.useState(!1),[d,j]=f.useState(1),w=10,{data:b,isLoading:y}=de({queryKey:["/api/family"]}),n=(b==null?void 0:b.orphans)||[],re=n.length,O=Z({resolver:ee(Ce),defaultValues:{orphanName:"",orphanBirthDate:"",orphanID:"",gender:"",guardianName:"",guardianID:"",guardianBirthDate:"",fatherName:"",fatherID:"",martyrdomDate:"",hasChronicIllness:!1,chronicIllnessType:"",isDisabled:!1,disabilityType:"",hasWarInjury:!1,warInjuryType:"",bankAccountNumber:"",accountHolderName:"",currentAddress:"",originalAddress:"",mobileNumber:"",backupMobileNumber:""}}),te=s=>{p(s),s||(g(null),O.reset({orphanName:"",orphanBirthDate:"",orphanID:"",gender:"",guardianName:"",guardianID:"",guardianBirthDate:"",fatherName:"",fatherID:"",martyrdomDate:"",hasChronicIllness:!1,chronicIllnessType:"",isDisabled:!1,disabilityType:"",hasWarInjury:!1,warInjuryType:"",bankAccountNumber:"",accountHolderName:"",currentAddress:"",originalAddress:"",mobileNumber:"",backupMobileNumber:"",image:""}))},V=H({mutationFn:async s=>(await L.post("/api/orphans",s)).data,onSuccess:s=>{E.setQueryData(["/api/family"],a=>a&&a.orphans?{...a,orphans:[...a.orphans,s]}:a&&{...a,orphans:[s]}),r({title:"تم الإضافة بنجاح",description:"تم إضافة اليتيم إلى الأسرة",variant:"default"}),p(!1),g(null)},onError:s=>{r({title:"خطأ في الإضافة",description:s.message,variant:"destructive"})}}),W=H({mutationFn:async({id:s,data:a})=>{console.log("Updating orphan with ID:",s,"Data:",a);const I=await L.put(`/api/orphans/${s}`,a);return console.log("Update response status:",I.status),I.data},onSuccess:s=>{E.setQueryData(["/api/family"],a=>a&&a.orphans?{...a,orphans:a.orphans.map(I=>I.id===s.id?s:I)}:a),r({title:"تم التحديث بنجاح",description:"تم تحديث بيانات اليتيم",variant:"default"}),p(!1),g(null)},onError:s=>{console.error("Update mutation error:",s),r({title:"خطأ في التحديث",description:s.message,variant:"destructive"})}}),M=H({mutationFn:async s=>{console.log("Attempting to delete orphan with ID:",s),console.log("Orphan ID type in mutation:",typeof s);const a=await L.delete(`/api/orphans/${s}`);return console.log("Delete response status:",a.status),s},onSuccess:s=>{E.setQueryData(["/api/family"],a=>a&&a.orphans?{...a,orphans:a.orphans.filter(I=>I.id!==s)}:a),r({title:"تم الحذف بنجاح",description:"تم حذف اليتيم من الأسرة",variant:"default"}),S(!1),N(null)},onError:s=>{console.error("Delete mutation error:",s),r({title:"خطأ في الحذف",description:s.message,variant:"destructive"})}}),me=s=>{console.log("Form submitted with data:",s),u?(console.log("Updating existing orphan:",u.id),W.mutate({id:u.id,data:s})):(console.log("Creating new orphan"),V.mutate(s))},P=s=>{console.log("Editing orphan:",s);const a={id:s.id,orphanName:s.orphanName||"",orphanBirthDate:s.orphanBirthDate||"",orphanID:s.orphanID||"",gender:s.gender||"",guardianName:s.guardianName||"",guardianID:s.guardianID||"",guardianBirthDate:s.guardianBirthDate||"",fatherName:s.fatherName||"",fatherID:s.fatherID||"",martyrdomDate:s.martyrdomDate||"",martyrdomType:s.martyrdomType||"",hasChronicIllness:s.hasChronicIllness||!1,chronicIllnessType:s.chronicIllnessType||"",isDisabled:s.isDisabled||!1,disabilityType:s.disabilityType||"",hasWarInjury:s.hasWarInjury||!1,warInjuryType:s.warInjuryType||"",bankAccountNumber:s.bankAccountNumber||"",accountHolderName:s.accountHolderName||"",currentAddress:s.currentAddress||"",originalAddress:s.originalAddress||"",mobileNumber:s.mobileNumber||"",backupMobileNumber:s.backupMobileNumber||""};g(a),O.reset(a),p(!0)},$=()=>{g(null),O.reset({orphanName:"",orphanBirthDate:"",orphanID:"",gender:"",guardianName:"",guardianID:"",guardianBirthDate:"",fatherName:"",fatherID:"",martyrdomDate:"",martyrdomType:"",hasChronicIllness:!1,chronicIllnessType:"",isDisabled:!1,disabilityType:"",hasWarInjury:!1,warInjuryType:"",bankAccountNumber:"",accountHolderName:"",currentAddress:"",originalAddress:"",mobileNumber:"",backupMobileNumber:""}),p(!0)},z=s=>{console.log("Delete clicked for orphan:",s),console.log("Orphan ID:",s.id),console.log("Orphan ID type:",typeof s.id),console.log("Orphan ID Number:",Number(s.id)),console.log("Orphan ID String:",String(s.id)),console.log("Full orphan object:",JSON.stringify(s,null,2)),N(s),S(!0)},ae=()=>{if(o){console.log("Confirming delete for orphan:",o),console.log("Delete orphan ID:",o.id),console.log("Delete orphan ID type:",typeof o.id);const s=Number(o.id);if(console.log("Converted orphan ID:",s),isNaN(s)){r({title:"خطأ في المعرف",description:"معرف اليتيم غير صحيح",variant:"destructive"});return}M.mutate(s)}},D=Math.ceil(n.length/w),Q=n.slice((d-1)*w,d*w),{settings:v}=ce();return f.useEffect(()=>{v.siteTitle&&(document.title=v.siteTitle),v.language&&(document.documentElement.lang=v.language,document.body.dir=v.language==="ar"?"rtl":"ltr")},[v.siteTitle,v.language]),y?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(J,{}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg text-muted-foreground",children:"جاري تحميل البيانات..."})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(J,{}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 sm:mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground mb-2",children:"اليتامى"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"إدارة بيانات اليتامى"})]}),e.jsxs(x,{onClick:$,className:"flex items-center gap-2 w-full sm:w-auto justify-center",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm sm:text-base",children:"إضافة يتيم جديد"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsx(F,{children:e.jsx(_,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 sm:p-3 bg-blue-100 rounded-lg",children:e.jsx(U,{className:"h-5 w-5 sm:h-6 sm:w-6 text-primary"})}),e.jsxs("div",{className:"mr-3 sm:mr-4",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"إجمالي اليتامى"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-foreground",children:re})]})]})})}),e.jsx(F,{children:e.jsx(_,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 sm:p-3 bg-yellow-100 rounded-lg",children:e.jsx(U,{className:"h-5 w-5 sm:h-6 sm:w-6 text-yellow-600"})}),e.jsxs("div",{className:"mr-3 sm:mr-4",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"عدد الأيتام أقل من 18 سنة"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-foreground",children:n.filter(s=>oe(s.orphanBirthDate)<18).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"من الأيتام"})]})]})})})]}),e.jsxs(F,{children:[e.jsx(ne,{children:e.jsxs(xe,{className:"text-lg sm:text-xl",children:["قائمة اليتامى (",n.length," فرد)"]})}),e.jsx(_,{children:n.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block sm:hidden space-y-4",children:Q.map(s=>e.jsx(F,{className:"border border-gray-200",children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-base",children:s.orphanName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["رقم الهوية: ",s.orphanID||"غير محدد"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:()=>P(s),className:"p-2",children:e.jsx(X,{className:"h-3 w-3"})}),e.jsx(x,{variant:"destructive",size:"sm",onClick:()=>z(s),className:"p-2",children:e.jsx(Y,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"تاريخ الميلاد:"}),e.jsx("p",{className:"font-medium",children:s.orphanBirthDate})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الجنس:"}),e.jsx("p",{className:"font-medium",children:q(s.gender)||"غير محدد"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"العمر:"}),e.jsx(K,{variant:"outline",className:"text-xs",children:G(s.orphanBirthDate)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"حالة الوفاة:"}),e.jsxs("p",{className:"font-medium",children:[s.martyrdomType==="war_2023"&&"شهيد حرب ٢٠٢٣",s.martyrdomType==="pre_2023_war"&&"شهيد حرب ما قبل ذلك",s.martyrdomType==="natural_death"&&"وفاة طبيعية",!s.martyrdomType&&"غير محدد"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"اسم الوصي:"}),e.jsx("p",{className:"font-medium",children:s.guardianName})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"رقم الجوال:"}),e.jsx("p",{className:"font-medium",children:s.mobileNumber||"غير محدد"})]}),s.image&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"الصورة:"}),e.jsx("div",{className:"mt-1 flex justify-center",children:e.jsx("img",{src:s.image,alt:"صورة اليتيم",className:"max-h-20 max-w-full object-contain border rounded"})})]})]})]})})},s.id))}),e.jsx("div",{className:"hidden sm:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-background",children:[e.jsx("th",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-right font-medium text-muted-foreground text-sm",children:"اسم اليتيم"}),e.jsx("th",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-right font-medium text-muted-foreground text-sm",children:"رقم الهوية"}),e.jsx("th",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-right font-medium text-muted-foreground text-sm",children:"تاريخ الميلاد"}),e.jsx("th",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-right font-medium text-muted-foreground text-sm",children:"الجنس"}),e.jsx("th",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-right font-medium text-muted-foreground text-sm",children:"العمر"}),e.jsx("th",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-right font-medium text-muted-foreground text-sm",children:"حالة الوفاة"}),e.jsx("th",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-right font-medium text-muted-foreground text-sm",children:"اسم الوصي"}),e.jsx("th",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-right font-medium text-muted-foreground text-sm",children:"رقم الجوال"}),e.jsx("th",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-right font-medium text-muted-foreground text-sm",children:"الصورة"}),e.jsx("th",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-right font-medium text-muted-foreground text-sm",children:"الإجراءات"})]})}),e.jsx("tbody",{children:Q.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-sm",children:s.orphanName}),e.jsx("td",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-sm",children:s.orphanID||"غير محدد"}),e.jsx("td",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-sm",children:s.orphanBirthDate}),e.jsx("td",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-sm",children:q(s.gender)||"غير محدد"}),e.jsx("td",{className:"border border-gray-300 px-3 sm:px-4 py-2",children:e.jsx(K,{variant:"outline",className:"text-xs",children:G(s.orphanBirthDate)})}),e.jsxs("td",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-sm",children:[s.martyrdomType==="war_2023"&&"شهيد حرب ٢٠٢٣",s.martyrdomType==="pre_2023_war"&&"شهيد حرب ما قبل ذلك",s.martyrdomType==="natural_death"&&"وفاة طبيعية",!s.martyrdomType&&"غير محدد"]}),e.jsx("td",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-sm",children:s.guardianName}),e.jsx("td",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-sm",children:s.mobileNumber||"غير محدد"}),e.jsx("td",{className:"border border-gray-300 px-3 sm:px-4 py-2 text-sm",children:s.image?e.jsx("img",{src:s.image,alt:"صورة اليتيم",className:"max-h-12 max-w-full object-contain border rounded mx-auto"}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"لا توجد صورة"})}),e.jsx("td",{className:"border border-gray-300 px-3 sm:px-4 py-2",children:e.jsxs("div",{className:"flex space-x-1 sm:space-x-2 space-x-reverse",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:()=>P(s),className:"p-1.5 sm:p-2",children:e.jsx(X,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),e.jsx(x,{variant:"destructive",size:"sm",onClick:()=>z(s),className:"p-1.5 sm:p-2",children:e.jsx(Y,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]})})]},s.id))})]})}),e.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-2 mt-4",children:[e.jsx(x,{variant:"outline",size:"sm",disabled:d===1,onClick:()=>j(d-1),className:"text-sm",children:"السابق"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Array.from({length:D},(s,a)=>a+1).map(s=>e.jsx(x,{variant:s===d?"default":"outline",size:"sm",onClick:()=>j(s),className:"text-sm min-w-[32px] h-8",children:s},s))}),e.jsx(x,{variant:"outline",size:"sm",disabled:d===D,onClick:()=>j(d+1),className:"text-sm",children:"التالي"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"h-10 w-10 sm:h-12 sm:w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"لا توجد أيتام مسجلين"}),e.jsx(x,{onClick:$,className:"mt-4 w-full sm:w-auto",children:"إضافة يتيم جديد"})]})})]}),e.jsx(ie,{open:h,onOpenChange:te,children:e.jsxs(he,{className:"w-[95vw] max-w-2xl max-h-[90vh] overflow-y-auto sm:w-full",children:[e.jsx(ue,{className:"px-4 sm:px-6",children:e.jsx(pe,{className:"text-lg sm:text-xl font-bold text-center",children:u?"تعديل بيانات اليتيم":"إضافة يتيم جديد"})}),e.jsx("div",{className:"px-4 sm:px-6 py-4",children:e.jsx(Ae,{initialData:u,onSubmit:me,onCancel:()=>{p(!1),g(null)},isLoading:V.isPending||W.isPending,isEdit:!!u})})]})}),e.jsx(Ne,{open:t,onOpenChange:S,children:e.jsxs(je,{className:"w-[95vw] max-w-md mx-auto sm:w-full",children:[e.jsxs(be,{className:"px-4 sm:px-6",children:[e.jsx(fe,{className:"text-lg sm:text-xl font-bold text-center",children:"تأكيد الحذف"}),e.jsxs(ye,{className:"text-right text-sm sm:text-base",children:['هل أنت متأكد من حذف اليتيم "',o==null?void 0:o.orphanName,'"؟',e.jsx("br",{}),"لا يمكن التراجع عن هذا الإجراء."]})]}),e.jsxs(ve,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 pb-4 sm:pb-6",children:[e.jsx(Ie,{className:"w-full sm:w-auto",children:"إلغاء"}),e.jsx(we,{onClick:ae,className:"w-full sm:w-auto bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:M.isPending,children:M.isPending?"جاري الحذف...":"حذف"})]})]})})]})]})}export{Le as default};
