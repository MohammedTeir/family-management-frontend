import{r as n,c as v,b as $,j as e,C as w,e as B,f as L,d as _,I as p,S,m as C,n as k,p as F,q as o,B as h,P as T,O as A}from"./index-ZYzdAsGm.js";import{a as D}from"./dropdown-menu-C5FzIU9D.js";import{P as U,A as V}from"./page-wrapper-DEQQYva8.js";import"./index-CvI2JamZ.js";import"./baby-B20HtjzY.js";import"./file-text-WTwHpCUH.js";const E=20;function W(){const[l,t]=n.useState(1),[d,g]=n.useState(""),[i,j]=n.useState("all"),[c,f]=n.useState("all"),[m,y]=n.useState(""),[x,N]=n.useState(""),{data:a,isLoading:I,error:K}=v({queryKey:["/api/admin/logs",{page:l,search:d,type:i,userId:c,startDate:m,endDate:x}],queryFn:async()=>{const s=new URLSearchParams;return s.append("page",String(l)),s.append("pageSize",String(E)),d&&s.append("search",d),i!=="all"&&s.append("type",i),c!=="all"&&s.append("userId",c),m&&s.append("startDate",m),x&&s.append("endDate",x),(await A.get(`/api/admin/logs?${s.toString()}`)).data},keepPreviousData:!0}),{data:b}=v({queryKey:["/api/admin/users"],queryFn:async()=>(await A.get("/api/admin/users")).data,staleTime:5*60*1e3}),{settings:r}=$();n.useEffect(()=>{r.siteTitle&&(document.title=r.siteTitle),r.language&&(document.documentElement.lang=r.language,document.body.dir=r.language==="ar"?"rtl":"ltr")},[r.siteTitle,r.language]);const u=s=>{switch(s){case"family_creation":return"إنشاء عائلة";case"family_update":return"تحديث عائلة";case"family_deletion":return"حذف عائلة";case"admin_family_update":return"تحديث عائلة من قبل المشرف";case"member_creation":return"إنشاء فرد";case"member_update":return"تحديث فرد";case"member_deletion":return"حذف فرد";case"admin_member_creation":return"إنشاء فرد من قبل المشرف";case"admin_member_deletion":return"حذف فرد من قبل المشرف";case"orphan_creation":return"إنشاء يتيم";case"orphan_update":return"تحديث يتيم";case"orphan_deletion":return"حذف يتيم";case"admin_orphan_creation":return"إنشاء يتيم من قبل المشرف";case"admin_orphan_update":return"تحديث يتيم من قبل المشرف";case"admin_orphan_deletion":return"حذف يتيم من قبل المشرف";case"spouse_update":return"تحديث بيانات الزوج/الزوجة";case"login":return"تسجيل دخول";case"failed_login":return"محاولة تسجيل دخول فاشلة";default:return s}},P=Array.from(new Set(a==null?void 0:a.map(s=>s.type).filter(Boolean))),q=b?b.filter(s=>s.role==="admin"||s.role==="root"):[];return e.jsx(U,{children:e.jsx("div",{className:"container mx-auto p-4 sm:p-6 space-y-4 sm:space-y-6",children:e.jsxs(w,{children:[e.jsx(B,{children:e.jsxs(L,{className:"text-lg sm:text-xl",children:[e.jsx(V,{className:"inline-block ml-2 h-5 w-5 sm:h-6 sm:w-6"}),"سجل النشاطات"]})}),e.jsxs(_,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"بحث"}),e.jsx(p,{placeholder:"بحث في الرسائل...",value:d,onChange:s=>{t(1),g(s.target.value)},className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"نوع السجل"}),e.jsxs(S,{value:i,onValueChange:s=>{t(1),j(s)},children:[e.jsx(C,{className:"w-full",children:e.jsx(k,{placeholder:"كل الأنواع"})}),e.jsxs(F,{children:[e.jsx(o,{value:"all",children:"كل الأنواع"}),P.map(s=>e.jsx(o,{value:s,children:u(s)},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"المستخدم"}),e.jsxs(S,{value:c,onValueChange:s=>{t(1),f(s)},children:[e.jsx(C,{className:"w-full",children:e.jsx(k,{placeholder:"جميع المستخدمين"})}),e.jsxs(F,{children:[e.jsx(o,{value:"all",children:"جميع المستخدمين"}),q.map(s=>e.jsxs(o,{value:String(s.id),children:[s.username," (",s.role==="root"?"مشرف رئيسي":s.role==="admin"?"مشرف":"مستخدم",")"]},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"من تاريخ"}),e.jsx(p,{type:"date",value:m,onChange:s=>{t(1),y(s.target.value)},className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"إلى تاريخ"}),e.jsx(p,{type:"date",value:x,onChange:s=>{t(1),N(s.target.value)},className:"w-full"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(h,{variant:"outline",onClick:()=>{g(""),j("all"),f("all"),y(""),N(""),t(1)},className:"w-full",children:"تصفية"})})]}),I?e.jsx("div",{className:"text-center py-8 sm:py-12 text-muted-foreground",children:"جاري تحميل السجلات..."}):a&&a.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto rounded-lg border border-border",children:e.jsxs("table",{className:"min-w-full bg-card",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 lg:px-4 py-2 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"#"}),e.jsx("th",{className:"px-3 lg:px-4 py-2 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"النوع"}),e.jsx("th",{className:"px-3 lg:px-4 py-2 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"الرسالة"}),e.jsx("th",{className:"px-3 lg:px-4 py-2 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-3 lg:px-4 py-2 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"التاريخ"})]})}),e.jsx("tbody",{className:"bg-card divide-y divide-border",children:a.map(s=>e.jsxs("tr",{className:"hover:bg-muted",children:[e.jsx("td",{className:"px-3 lg:px-4 py-2 text-sm text-foreground",children:s.id}),e.jsx("td",{className:"px-3 lg:px-4 py-2",children:e.jsx(D,{variant:"secondary",className:"text-xs",children:u(s.type)})}),e.jsx("td",{className:"px-3 lg:px-4 py-2 text-sm text-foreground max-w-xs truncate",children:s.message}),e.jsx("td",{className:"px-3 lg:px-4 py-2 text-sm text-foreground",children:s.user?`${s.user.username} (${s.user.role==="root"?"مشرف رئيسي":s.user.role==="admin"?"مشرف":"مستخدم"})`:"—"}),e.jsx("td",{className:"px-3 lg:px-4 py-2 text-sm text-muted-foreground",children:T(s.createdAt)})]},s.id))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:a.map(s=>e.jsx(w,{className:"border border-border",children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{variant:"secondary",className:"text-xs",children:u(s.type)}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["#",s.id]})]}),e.jsx("p",{className:"text-sm text-foreground break-words",children:s.message}),e.jsxs("div",{className:"flex flex-col xs:flex-row xs:items-center justify-between gap-1 xs:gap-2 pt-2 border-t border-border",children:[e.jsx("span",{className:"text-xs text-foreground",children:s.user?`${s.user.username} (${s.user.role==="root"?"مشرف رئيسي":s.user.role==="admin"?"مشرف":"مستخدم"})`:"—"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:T(s.createdAt)})]})]})})},s.id))})]}):e.jsx("div",{className:"text-center py-8 sm:py-12 text-muted-foreground",children:"لا توجد سجلات."}),e.jsxs("div",{className:"flex flex-col xs:flex-row justify-center items-center gap-3 xs:gap-4 mt-4 sm:mt-6",children:[e.jsx(h,{variant:"outline",disabled:l===1,onClick:()=>t(s=>Math.max(1,s-1)),className:"w-full xs:w-auto text-sm",children:"السابق"}),e.jsxs("span",{className:"text-sm sm:text-base text-foreground order-first xs:order-none",children:["صفحة ",l]}),e.jsx(h,{variant:"outline",disabled:!a||a.length<E,onClick:()=>t(s=>s+1),className:"w-full xs:w-auto text-sm",children:"التالي"})]})]})]})})})}export{W as default};
